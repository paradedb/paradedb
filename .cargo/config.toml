# Minimum Supported CPU Era Configuration
#
# Setting target-cpu enables SIMD auto-vectorization (AVX2 on x86, NEON on ARM)
# in key dependencies like tantivy, arrow, datafusion, and bitpacking.
#
# x86_64:  x86-64-v3 (Intel Haswell 2013+ / AMD Excavator 2015+)
# aarch64: cortex-a76 (AWS Graviton 2+ / Ampere Altra)
# macOS:   apple-m1 (Apple Silicon)

[target.x86_64-unknown-linux-gnu]
rustflags = ["-Ctarget-cpu=x86-64-v3"]

[target.aarch64-unknown-linux-gnu]
rustflags = ["-Ctarget-cpu=cortex-a76"]

# macOS requires -undefined,dynamic_lookup for pgrx (PostgreSQL symbols resolved at runtime)
[target.aarch64-apple-darwin]
rustflags = [
  "-Ctarget-cpu=apple-m1",
  "-Clink-arg=-Wl,-undefined,dynamic_lookup",
]
