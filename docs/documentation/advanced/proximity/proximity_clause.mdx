---
title: Proximity Clause
---

<Note>
  Proximity queries only work over tokenized fields which store positions. This
  is `pg_search`'s default for `TEXT` and `VARCHAR` fields.
</Note>

A `ProximityClause` is the primitive SQL types for building complex [proximity queries](/documentation/advanced/proximity/proximity).

## Proximity Clause Primitives

`pg_search`'s proximity capabilities are built on four primitives which can be combined to form a final proximity query. Each is constructed using a specific SQL builder function, and each returns a value of the type `paradedb.proximityclause`.

### Term

A proximity term is a single "word" intended to be an **exact match** against a tokenized word in the index.

<CodeGroup>
```sql Proximity Term
SELECT paradedb.prox_term('bbq');
prox_term
-----------
bbq
(1 row)

````
</CodeGroup>

You can see that this output the same value passed to `paradedb.prox_term()`.  This is due to an _implicit_ cast to TEXT and will happen automatically in other contexts where a `paradedb.proximityclause` is needed.

This clause style can also be created using that cast:
<CodeGroup>
```sql Cast from TEXT
SELECT 'bbq'::paradedb.proximityclause;
proximityclause
-----------------
bbq
(1 row)
````

</CodeGroup>

### Regular Expression

This primitive is for matching a regular expression pattern. The regular expression is case-sensitive.

<CodeGroup>
```sql Proximity Regular Expression
SELECT paradedb.prox_regex('chi..en');
prox_regex
------------------------------------
{"Term":{"Rexgex":["chi..en",50]}}      -- chicken
(1 row)
```
</CodeGroup>

`paradedb.prox_regex()` has a second, optional argument to specify the maximum number of expansions to perform during query execution. The default, shown here, is `50`.

### Array

The array primitive is used for matching one or more proximity clauses. Its arguments are a `VARIADIC ARRAY` of individual `paradedb.proximityclause` values.

<CodeGroup>
```sql Proximity Array
SELECT paradedb.prox_array(
    'ribs', -- implicitly cast to paradedb.proximityclause
    paradedb.prox_term('bbq'),
    paradedb.prox_regex('chi..en'),
    paradedb.prox_clause('this', 3, 'that')
);
prox_array
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
{"Clauses":[{"Term":{"Term":"ribs"}},{"Term":{"Term":"bbq"}},{"Term":{"Rexgex":["chi..en",50]}},{"Proximity":{"left":{"Term":{"Term":"this"}},"distance":{"AnyOrder":3},"right":{"Term":{"Term":"that"}}}}]}
```
</CodeGroup>

### Clause

A proximity clause is a triplet containing a `left` proximity clause, a distance value, and a `right` proximity clause. Depending on how the clause is constructed, the `left` and `right` clauses can be in order or not. If they're in order that means the `left` clause must appear at least "distance" tokens before the `right` clause.

The functions for generating a proximity clause are:

```sql
-- build a paradedb.proximityclause where the `left` and `right` clauses
-- must be within `distance` tokens of each other, in any order
FUNCTION paradedb.prox_clause(
    "left" paradedb.proximityclause,
    distance integer,
    "right" paradedb.proximityclause
)

-- build a paradedb.proximityclause where the `left` clause must appear
-- at least `distance` tokens before the `right` clause
FUNCTION paradedb.prox_clause_in_order(
    "left" paradedb.proximityclause,
    distance integer,
    "right" paradedb.proximityclause
)
```

<CodeGroup>
```sql Unordered Proximity Clause
SELECT paradedb.prox_clause('chicken', 5, 'bbq');
prox_clause
--------------------------------------------------------------------------------------------------------------
{"Proximity":{"left":{"Term":{"Term":"chicken"}},"distance":{"AnyOrder":5},"right":{"Term":{"Term":"bbq"}}}}
(1 row)

--- This example would match a document containing the text:
--- "chicken will be served at the bbq"
--- in addition to a document that contains:
--- "bbq chicken".

````
```sql Ordered Proximity Clause
SELECT paradedb.prox_clause_in_order('chicken', 3, 'bbq');
prox_clause_in_order
-------------------------------------------------------------------------------------------------------------
{"Proximity":{"left":{"Term":{"Term":"chicken"}},"distance":{"InOrder":3},"right":{"Term":{"Term":"bbq"}}}}
(1 row)

--- This example would match a document containing the text:
---            "chicken at the bbq"
--- in addition to a document that contains:
---            "bbq chicken".
````

</CodeGroup>

Because the `left` and `right` arguments are of type `paradedb.proximityclause` and because `paradedb.prox_clause()` also returns a `paradedb.proximityclause`, this means complex clauses can be built where some clause is within some distance of another, or any combination:

<CodeGroup>
```sql Complex Proximity Clauses
SELECT paradedb.prox_clause(
    paradedb.prox_array('ribs', paradedb.prox_regex('chi..en')),
    5,
    paradedb.prox_clause_in_order('saturday', 0, 'bbq')
);
prox_clause
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
{"Proximity":{"left":{"Clauses":[{"Term":{"Term":"ribs"}},{"Term":{"Rexgex":["chi..en",50]}}]},"distance":{"AnyOrder":5},"right":{"Proximity":{"left":{"Term":{"Term":"saturday"}},"distance":{"InOrder":0},"right":{"Term":{"Term":"bbq"}}}}}}

--- This example would match a document containing the text:
--- "the saturday bbq will serve corn, beans, and chikcen"
--- in addition to a document that contains
--- "ribs are on the menu at the saturday bbq"

```
</CodeGroup>
```
