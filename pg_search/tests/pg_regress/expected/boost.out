EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description @@@ 'running shoes'::pdb.boost(3);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description @@@ 'running shoes'::pdb.boost(3.14159);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description @@@ 'running shoes'::pdb.boost(0.5);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description @@@ 'running shoes'::pdb.boost(0);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description @@@ 'running shoes'::pdb.boost(-100);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description &&& 'running shoes'::pdb.boost(3);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description &&& 'running shoes'::pdb.boost(3.14159);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description &&& 'running shoes'::pdb.boost(0.5);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description &&& 'running shoes'::pdb.boost(0);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description &&& 'running shoes'::pdb.boost(-100);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ||| 'running shoes'::pdb.boost(3);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ||| 'running shoes'::pdb.boost(3.14159);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ||| 'running shoes'::pdb.boost(0.5);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ||| 'running shoes'::pdb.boost(0);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ||| 'running shoes'::pdb.boost(-100);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ### 'running shoes'::pdb.boost(3);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ### 'running shoes'::pdb.boost(3.14159);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ### 'running shoes'::pdb.boost(0.5);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ### 'running shoes'::pdb.boost(0);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ### 'running shoes'::pdb.boost(-100);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description === 'shoes'::pdb.boost(3);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description === 'shoes'::pdb.boost(3.14159);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description === 'shoes'::pdb.boost(0.5);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description === 'shoes'::pdb.boost(0);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description === 'shoes'::pdb.boost(-100);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description @@@ pdb.term('shoes')::pdb.boost(-100);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description @@@ ('running' ##3## 'shoes')::pdb.boost(3);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description &&& ARRAY['running', 'shoes']::pdb.boost(3);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ||| ARRAY['running', 'shoes']::pdb.boost(3);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description ### ARRAY['running', 'shoes']::pdb.boost(3);
ERROR:  relation "regress.mock_items" does not exist at character 60
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description === ARRAY['running', 'shoes']::pdb.boost(3);
ERROR:  relation "regress.mock_items" does not exist at character 60
--
-- validate basic json representations
--
SELECT 'foo'::pdb.boost(3);
                                            boost                                            
---------------------------------------------------------------------------------------------
 {"score_adjusted":{"query":{"unclassified_string":{"string":"foo"}},"score":{"Boost":3.0}}}
(1 row)

SELECT pdb.term('foo')::pdb.boost(3);
                                              term                                               
-------------------------------------------------------------------------------------------------
 {"score_adjusted":{"query":{"term":{"value":"foo","is_datetime":false}},"score":{"Boost":3.0}}}
(1 row)

SELECT ARRAY['foo', 'bar']::pdb.boost(3);
                                               array                                               
---------------------------------------------------------------------------------------------------
 {"score_adjusted":{"query":{"unclassified_array":{"array":["foo","bar"]}},"score":{"Boost":3.0}}}
(1 row)

--
-- oob cases.  these all get clamped to [-2048..2048]
--
SELECT 'foo'::pdb.boost(2049);
                                             boost                                              
------------------------------------------------------------------------------------------------
 {"score_adjusted":{"query":{"unclassified_string":{"string":"foo"}},"score":{"Boost":2048.0}}}
(1 row)

SELECT 'foo'::pdb.boost(-2049);
                                              boost                                              
-------------------------------------------------------------------------------------------------
 {"score_adjusted":{"query":{"unclassified_string":{"string":"foo"}},"score":{"Boost":-2048.0}}}
(1 row)

SELECT 'foo'::pdb.boost(Inf);
                                             boost                                              
------------------------------------------------------------------------------------------------
 {"score_adjusted":{"query":{"unclassified_string":{"string":"foo"}},"score":{"Boost":2048.0}}}
(1 row)

--
-- error cases
--
SELECT 'foo'::pdb.boost(hi_mom);
ERROR:  invalid boost value: hi_mom at character 15
SELECT 'foo'::pdb.boost(1,2);
ERROR:  assertion failed: typmod_parts.len() == 1 at character 15
SELECT 'foo'::pdb.boost(NaN);
ERROR:  only 16 bit floats in the range [-2048..2048] are supported at character 15
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM regress.mock_items WHERE description @@@ 'shoes'::pdb.boost;
ERROR:  relation "regress.mock_items" does not exist at character 60
