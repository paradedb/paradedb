-- Test basic join hook functionality
-- This test verifies that our custom join hook is being called
-- Create the extension first
CREATE EXTENSION IF NOT EXISTS pg_search;
-- Enable the custom join feature
SET paradedb.enable_custom_join = true;
-- Create test tables with BM25 indexes
CREATE TABLE documents_join_test (
    id SERIAL PRIMARY KEY,
    title TEXT,
    content TEXT
);
CREATE TABLE files_join_test (
    id SERIAL PRIMARY KEY,
    document_id INTEGER,
    filename TEXT,
    content TEXT
);
-- Insert test data
INSERT INTO documents_join_test (title, content) VALUES 
    ('Document 1', 'This is the first document about technology'),
    ('Document 2', 'This is the second document about science'),
    ('Document 3', 'This is the third document about research');
INSERT INTO files_join_test (document_id, filename, content) VALUES 
    (1, 'file1.txt', 'Technology file content'),
    (2, 'file2.txt', 'Science file content'),
    (3, 'file3.txt', 'Research file content');
-- Create BM25 indexes
CREATE INDEX documents_join_test_idx ON documents_join_test USING bm25 (
    id,
    title,
    content
) WITH (
    key_field = 'id',
    text_fields = '{"title": {"tokenizer": {"type": "default"}}, "content": {"tokenizer": {"type": "default"}}}'
);
CREATE INDEX files_join_test_idx ON files_join_test USING bm25 (
    id,
    document_id,
    filename,
    content
) WITH (
    key_field = 'id',
    numeric_fields = '{"document_id": {"fast": true}}',
    text_fields = '{"filename": {"tokenizer": {"type": "default"}}, "content": {"tokenizer": {"type": "default"}}}'
);
-- Test 1: Simple INNER JOIN with search predicates
-- This should trigger our join hook and show debug output
SELECT d.id, d.title, f.filename
FROM documents_join_test d
JOIN files_join_test f ON d.id = f.document_id
WHERE d.content @@@ 'technology' AND f.content @@@ 'file';
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["documents_join_test"], inner relids: ["files_join_test"]
WARNING:  ParadeDB: Checking relation documents_join_test (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation documents_join_test
WARNING:  ParadeDB: Checking relation files_join_test (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation files_join_test
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_join_test (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_join_test: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation files_join_test (rti 2)
WARNING:  ParadeDB: Extracted search query for files_join_test: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for documents_join_test - uses_search: true
WARNING:  ParadeDB: Inner predicate for files_join_test - uses_search: true
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["files_join_test"], inner relids: ["documents_join_test"]
WARNING:  ParadeDB: Checking relation files_join_test (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation files_join_test
WARNING:  ParadeDB: Checking relation documents_join_test (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation documents_join_test
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation files_join_test (rti 2)
WARNING:  ParadeDB: Extracted search query for files_join_test: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_join_test (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_join_test: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for files_join_test - uses_search: true
WARNING:  ParadeDB: Inner predicate for documents_join_test - uses_search: true
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 3 entries
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=1 to join_attr_1
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=2 to join_attr_2
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=3 to join_attr_3
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Using stored search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Creating join tuple descriptor with 3 columns
WARNING:  ParadeDB: Tuple descriptor created successfully
WARNING:  ParadeDB: Join execution initialized with 3 target columns
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Starting join execution - initializing search
WARNING:  ParadeDB: Initializing real search execution for join
WARNING:  ParadeDB: Join execution state found
WARNING:  ParadeDB: Search predicates found in join state - outer: 1, inner: 1
WARNING:  ParadeDB: Retrieved search predicates from join state - outer: 1, inner: 1
WARNING:  ParadeDB: Initializing search readers for join relations
WARNING:  ParadeDB: Opening search reader for outer relation documents_join_test
WARNING:  ParadeDB: Successfully opened search reader for documents_join_test
WARNING:  ParadeDB: Opening search reader for inner relation files_join_test
WARNING:  ParadeDB: Successfully opened search reader for files_join_test
WARNING:  ParadeDB: Initialized 2 search readers
WARNING:  ParadeDB: Executing real searches on join relations
WARNING:  ParadeDB: Executing search on outer relation documents_join_test
WARNING:  ParadeDB: Executing real BM25 search on relation documents_join_test
WARNING:  ParadeDB: Real search on documents_join_test returned 1 results
WARNING:  ParadeDB: Found 1 results for outer relation documents_join_test
WARNING:  ParadeDB: Executing search on inner relation files_join_test
WARNING:  ParadeDB: Executing real BM25 search on relation files_join_test
WARNING:  ParadeDB: Real search on files_join_test returned 3 results
WARNING:  ParadeDB: Found 3 results for inner relation files_join_test
WARNING:  ParadeDB: Completed real search execution - outer: 1, inner: 3
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing outer search
WARNING:  ParadeDB: Executing search on outer relation
WARNING:  ParadeDB: Outer search completed - 1 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing inner search
WARNING:  ParadeDB: Executing search on inner relation
WARNING:  ParadeDB: Inner search completed - 3 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [1/1] Ã— [1/3]
WARNING:  ParadeDB: Creating join result tuple for outer[0], inner[0]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Getting relation OIDs - outer predicates: 1, inner predicates: 1
WARNING:  ParadeDB: Outer relation: documents_join_test
WARNING:  ParadeDB: Inner relation: files_join_test
WARNING:  ParadeDB: Fetching real heap tuple values from relations documents_join_test and files_join_test
WARNING:  ParadeDB: Detected relations from predicates - outer: 'documents_join_test', inner: 'files_join_test'
WARNING:  ParadeDB: Fetching all columns with names from relation documents_join_test with CTID 1
WARNING:  ParadeDB: documents_join_test column 'id' = '1'
WARNING:  ParadeDB: documents_join_test column 'title' = 'Document 1'
WARNING:  ParadeDB: documents_join_test column 'content' = 'This is the first document about technology'
WARNING:  ParadeDB: Successfully fetched 3 columns from documents_join_test relation
WARNING:  ParadeDB: Fetching all columns with names from relation files_join_test with CTID 1
WARNING:  ParadeDB: files_join_test column 'id' = '1'
WARNING:  ParadeDB: files_join_test column 'document_id' = '1'
WARNING:  ParadeDB: files_join_test column 'filename' = 'file1.txt'
WARNING:  ParadeDB: files_join_test column 'content' = 'Technology file content'
WARNING:  ParadeDB: Successfully fetched 4 columns from files_join_test relation
WARNING:  ParadeDB: Fetched 3 columns from outer relation, 4 from inner relation
WARNING:  ParadeDB: Analyzing 3 target entries using direct name mapping
WARNING:  ParadeDB: Getting relation OIDs - outer predicates: 1, inner predicates: 1
WARNING:  ParadeDB: Outer relation: documents_join_test
WARNING:  ParadeDB: Inner relation: files_join_test
WARNING:  ParadeDB: Analyzing target entry 1 with name 'id'
WARNING:  ParadeDB: Checking for column 'id' in relation documents_join_test - found: true, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Found column 'id' in outer relation documents_join_test
WARNING:  ParadeDB: Target entry 1 ('id') mapped to: OuterColumn("id")
WARNING:  ParadeDB: Analyzing target entry 2 with name 'title'
WARNING:  ParadeDB: Checking for column 'title' in relation documents_join_test - found: true, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Found column 'title' in outer relation documents_join_test
WARNING:  ParadeDB: Target entry 2 ('title') mapped to: OuterColumn("title")
WARNING:  ParadeDB: Analyzing target entry 3 with name 'filename'
WARNING:  ParadeDB: Checking for column 'filename' in relation documents_join_test - found: false, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Checking for column 'filename' in relation files_join_test - found: true, available columns: ["id", "document_id", "filename", "content"]
WARNING:  ParadeDB: Found column 'filename' in inner relation files_join_test
WARNING:  ParadeDB: Target entry 3 ('filename') mapped to: InnerColumn("filename")
WARNING:  ParadeDB: Mapped 3 out of 3 column values: [Some("1"), Some("Document 1"), Some("file1.txt")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [Some("1"), Some("Document 1"), Some("file1.txt")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [1/1] Ã— [2/3]
WARNING:  ParadeDB: Creating join result tuple for outer[0], inner[1]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Getting relation OIDs - outer predicates: 1, inner predicates: 1
WARNING:  ParadeDB: Outer relation: documents_join_test
WARNING:  ParadeDB: Inner relation: files_join_test
WARNING:  ParadeDB: Fetching real heap tuple values from relations documents_join_test and files_join_test
WARNING:  ParadeDB: Detected relations from predicates - outer: 'documents_join_test', inner: 'files_join_test'
WARNING:  ParadeDB: Fetching all columns with names from relation documents_join_test with CTID 1
WARNING:  ParadeDB: documents_join_test column 'id' = '1'
WARNING:  ParadeDB: documents_join_test column 'title' = 'Document 1'
WARNING:  ParadeDB: documents_join_test column 'content' = 'This is the first document about technology'
WARNING:  ParadeDB: Successfully fetched 3 columns from documents_join_test relation
WARNING:  ParadeDB: Fetching all columns with names from relation files_join_test with CTID 2
WARNING:  ParadeDB: files_join_test column 'id' = '2'
WARNING:  ParadeDB: files_join_test column 'document_id' = '2'
WARNING:  ParadeDB: files_join_test column 'filename' = 'file2.txt'
WARNING:  ParadeDB: files_join_test column 'content' = 'Science file content'
WARNING:  ParadeDB: Successfully fetched 4 columns from files_join_test relation
WARNING:  ParadeDB: Fetched 3 columns from outer relation, 4 from inner relation
WARNING:  ParadeDB: Analyzing 3 target entries using direct name mapping
WARNING:  ParadeDB: Getting relation OIDs - outer predicates: 1, inner predicates: 1
WARNING:  ParadeDB: Outer relation: documents_join_test
WARNING:  ParadeDB: Inner relation: files_join_test
WARNING:  ParadeDB: Analyzing target entry 1 with name 'id'
WARNING:  ParadeDB: Checking for column 'id' in relation documents_join_test - found: true, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Found column 'id' in outer relation documents_join_test
WARNING:  ParadeDB: Target entry 1 ('id') mapped to: OuterColumn("id")
WARNING:  ParadeDB: Analyzing target entry 2 with name 'title'
WARNING:  ParadeDB: Checking for column 'title' in relation documents_join_test - found: true, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Found column 'title' in outer relation documents_join_test
WARNING:  ParadeDB: Target entry 2 ('title') mapped to: OuterColumn("title")
WARNING:  ParadeDB: Analyzing target entry 3 with name 'filename'
WARNING:  ParadeDB: Checking for column 'filename' in relation documents_join_test - found: false, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Checking for column 'filename' in relation files_join_test - found: true, available columns: ["id", "document_id", "filename", "content"]
WARNING:  ParadeDB: Found column 'filename' in inner relation files_join_test
WARNING:  ParadeDB: Target entry 3 ('filename') mapped to: InnerColumn("filename")
WARNING:  ParadeDB: Mapped 3 out of 3 column values: [Some("1"), Some("Document 1"), Some("file2.txt")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [Some("1"), Some("Document 1"), Some("file2.txt")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [1/1] Ã— [3/3]
WARNING:  ParadeDB: Creating join result tuple for outer[0], inner[2]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Getting relation OIDs - outer predicates: 1, inner predicates: 1
WARNING:  ParadeDB: Outer relation: documents_join_test
WARNING:  ParadeDB: Inner relation: files_join_test
WARNING:  ParadeDB: Fetching real heap tuple values from relations documents_join_test and files_join_test
WARNING:  ParadeDB: Detected relations from predicates - outer: 'documents_join_test', inner: 'files_join_test'
WARNING:  ParadeDB: Fetching all columns with names from relation documents_join_test with CTID 1
WARNING:  ParadeDB: documents_join_test column 'id' = '1'
WARNING:  ParadeDB: documents_join_test column 'title' = 'Document 1'
WARNING:  ParadeDB: documents_join_test column 'content' = 'This is the first document about technology'
WARNING:  ParadeDB: Successfully fetched 3 columns from documents_join_test relation
WARNING:  ParadeDB: Fetching all columns with names from relation files_join_test with CTID 3
WARNING:  ParadeDB: files_join_test column 'id' = '3'
WARNING:  ParadeDB: files_join_test column 'document_id' = '3'
WARNING:  ParadeDB: files_join_test column 'filename' = 'file3.txt'
WARNING:  ParadeDB: files_join_test column 'content' = 'Research file content'
WARNING:  ParadeDB: Successfully fetched 4 columns from files_join_test relation
WARNING:  ParadeDB: Fetched 3 columns from outer relation, 4 from inner relation
WARNING:  ParadeDB: Analyzing 3 target entries using direct name mapping
WARNING:  ParadeDB: Getting relation OIDs - outer predicates: 1, inner predicates: 1
WARNING:  ParadeDB: Outer relation: documents_join_test
WARNING:  ParadeDB: Inner relation: files_join_test
WARNING:  ParadeDB: Analyzing target entry 1 with name 'id'
WARNING:  ParadeDB: Checking for column 'id' in relation documents_join_test - found: true, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Found column 'id' in outer relation documents_join_test
WARNING:  ParadeDB: Target entry 1 ('id') mapped to: OuterColumn("id")
WARNING:  ParadeDB: Analyzing target entry 2 with name 'title'
WARNING:  ParadeDB: Checking for column 'title' in relation documents_join_test - found: true, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Found column 'title' in outer relation documents_join_test
WARNING:  ParadeDB: Target entry 2 ('title') mapped to: OuterColumn("title")
WARNING:  ParadeDB: Analyzing target entry 3 with name 'filename'
WARNING:  ParadeDB: Checking for column 'filename' in relation documents_join_test - found: false, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Checking for column 'filename' in relation files_join_test - found: true, available columns: ["id", "document_id", "filename", "content"]
WARNING:  ParadeDB: Found column 'filename' in inner relation files_join_test
WARNING:  ParadeDB: Target entry 3 ('filename') mapped to: InnerColumn("filename")
WARNING:  ParadeDB: Mapped 3 out of 3 column values: [Some("1"), Some("Document 1"), Some("file3.txt")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [Some("1"), Some("Document 1"), Some("file3.txt")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Join matching complete - total matches: 3
WARNING:  ParadeDB: Cleaning up join execution
WARNING:  ParadeDB: Cleaning up join execution state
WARNING:  ParadeDB: ===== JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Search Results - Outer: 1, Inner: 3, Total Combinations: 3
WARNING:  ParadeDB: Join Processing - Matches: 3, Returned: 3, Success Rate: 100.0%
WARNING:  ParadeDB: Heap Tuple Access - Attempts: 6, Successes: 9, Success Rate: 150.0%
WARNING:  ParadeDB: Cleaned up 2 search readers
WARNING:  ParadeDB: Cleared 1 outer and 3 inner search results
WARNING:  ParadeDB: ===== END JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Join execution cleanup complete
 id |   title    | filename  
----+------------+-----------
  1 | Document 1 | file1.txt
  1 | Document 1 | file2.txt
  1 | Document 1 | file3.txt
(3 rows)

-- Test 2: JOIN without search predicates (should not trigger custom join)
SELECT d.id, d.title, f.filename  
FROM documents_join_test d
JOIN files_join_test f ON d.id = f.document_id
WHERE d.id = 1;
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["documents_join_test"], inner relids: ["files_join_test"]
WARNING:  ParadeDB: Checking relation documents_join_test (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation documents_join_test
WARNING:  ParadeDB: Checking relation files_join_test (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation files_join_test
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_join_test (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_join_test: uses_search_operator=false
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation files_join_test (rti 2)
WARNING:  ParadeDB: Extracted search query for files_join_test: uses_search_operator=false
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for documents_join_test - uses_search: false
WARNING:  ParadeDB: Inner predicate for files_join_test - uses_search: false
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["files_join_test"], inner relids: ["documents_join_test"]
WARNING:  ParadeDB: Checking relation files_join_test (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation files_join_test
WARNING:  ParadeDB: Checking relation documents_join_test (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation documents_join_test
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation files_join_test (rti 2)
WARNING:  ParadeDB: Extracted search query for files_join_test: uses_search_operator=false
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_join_test (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_join_test: uses_search_operator=false
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for files_join_test - uses_search: false
WARNING:  ParadeDB: Inner predicate for documents_join_test - uses_search: false
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
 id |   title    | filename  
----+------------+-----------
  1 | Document 1 | file1.txt
(1 row)

-- Test 3: Search on only one side (should not trigger custom join)
SELECT d.id, d.title, f.filename
FROM documents_join_test d  
JOIN files_join_test f ON d.id = f.document_id
WHERE d.content @@@ 'science';
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["documents_join_test"], inner relids: ["files_join_test"]
WARNING:  ParadeDB: Checking relation documents_join_test (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation documents_join_test
WARNING:  ParadeDB: Checking relation files_join_test (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation files_join_test
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_join_test (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_join_test: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 0 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 0, bilateral: false
WARNING:  ParadeDB: Outer predicate for documents_join_test - uses_search: true
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["files_join_test"], inner relids: ["documents_join_test"]
WARNING:  ParadeDB: Checking relation files_join_test (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation files_join_test
WARNING:  ParadeDB: Checking relation documents_join_test (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation documents_join_test
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_join_test (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_join_test: uses_search_operator=true
WARNING:  ParadeDB: Extracted 0 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 0, inner: 1, bilateral: false
WARNING:  ParadeDB: Inner predicate for documents_join_test - uses_search: true
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 3 entries
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=1 to join_attr_1
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=2 to join_attr_2
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=3 to join_attr_3
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 0, bilateral: false
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Using stored search predicates - outer: 1, inner: 0, bilateral: false
WARNING:  ParadeDB: Creating join tuple descriptor with 3 columns
WARNING:  ParadeDB: Tuple descriptor created successfully
WARNING:  ParadeDB: Join execution initialized with 3 target columns
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Starting join execution - initializing search
WARNING:  ParadeDB: Initializing real search execution for join
WARNING:  ParadeDB: Join execution state found
WARNING:  ParadeDB: Search predicates found in join state - outer: 1, inner: 0
WARNING:  ParadeDB: Retrieved search predicates from join state - outer: 1, inner: 0
WARNING:  ParadeDB: Initializing search readers for join relations
WARNING:  ParadeDB: Opening search reader for outer relation documents_join_test
WARNING:  ParadeDB: Successfully opened search reader for documents_join_test
WARNING:  ParadeDB: Initialized 1 search readers
WARNING:  ParadeDB: Executing real searches on join relations
WARNING:  ParadeDB: Executing search on outer relation documents_join_test
WARNING:  ParadeDB: Executing real BM25 search on relation documents_join_test
WARNING:  ParadeDB: Real search on documents_join_test returned 1 results
WARNING:  ParadeDB: Found 1 results for outer relation documents_join_test
WARNING:  ParadeDB: No inner search results, using default result
WARNING:  ParadeDB: Completed real search execution - outer: 1, inner: 1
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing outer search
WARNING:  ParadeDB: Executing search on outer relation
WARNING:  ParadeDB: Outer search completed - 1 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing inner search
WARNING:  ParadeDB: Executing search on inner relation
WARNING:  ParadeDB: Inner search completed - 1 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [1/1] Ã— [1/1]
WARNING:  ParadeDB: Creating join result tuple for outer[0], inner[0]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Getting relation OIDs - outer predicates: 1, inner predicates: 0
WARNING:  ParadeDB: Outer relation: documents_join_test
WARNING:  ParadeDB: No inner relation found
WARNING:  ParadeDB: Trying to infer missing relation, known relation: documents_join_test
WARNING:  ParadeDB: Fetching real heap tuple values from relations documents_join_test and unknown
WARNING:  ParadeDB: Detected relations from predicates - outer: 'documents_join_test', inner: 'unknown_inner'
WARNING:  ParadeDB: Fetching all columns with names from relation documents_join_test with CTID 2
WARNING:  ParadeDB: documents_join_test column 'id' = '2'
WARNING:  ParadeDB: documents_join_test column 'title' = 'Document 2'
WARNING:  ParadeDB: documents_join_test column 'content' = 'This is the second document about science'
WARNING:  ParadeDB: Successfully fetched 3 columns from documents_join_test relation
WARNING:  ParadeDB: Fetched 3 columns from outer relation, 0 from inner relation
WARNING:  ParadeDB: Analyzing 3 target entries using direct name mapping
WARNING:  ParadeDB: Getting relation OIDs - outer predicates: 1, inner predicates: 0
WARNING:  ParadeDB: Outer relation: documents_join_test
WARNING:  ParadeDB: No inner relation found
WARNING:  ParadeDB: Trying to infer missing relation, known relation: documents_join_test
WARNING:  ParadeDB: Analyzing target entry 1 with name 'id'
WARNING:  ParadeDB: Checking for column 'id' in relation documents_join_test - found: true, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Found column 'id' in outer relation documents_join_test
WARNING:  ParadeDB: Target entry 1 ('id') mapped to: OuterColumn("id")
WARNING:  ParadeDB: Analyzing target entry 2 with name 'title'
WARNING:  ParadeDB: Checking for column 'title' in relation documents_join_test - found: true, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Found column 'title' in outer relation documents_join_test
WARNING:  ParadeDB: Target entry 2 ('title') mapped to: OuterColumn("title")
WARNING:  ParadeDB: Analyzing target entry 3 with name 'filename'
WARNING:  ParadeDB: Checking for column 'filename' in relation documents_join_test - found: false, available columns: ["id", "title", "content"]
WARNING:  ParadeDB: Column 'filename' not found in either relation, using generic fallback
WARNING:  ParadeDB: No direct matches for 'filename', trying intelligent fallback with outer: ["id", "title", "content"], inner: []
WARNING:  ParadeDB: Target 'filename' looks like a name field, using outer column 'title'
WARNING:  ParadeDB: Target entry 3 ('filename') mapped to: OuterColumn("title")
WARNING:  ParadeDB: Mapped 3 out of 3 column values: [Some("2"), Some("Document 2"), Some("Document 2")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [Some("2"), Some("Document 2"), Some("Document 2")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Join matching complete - total matches: 1
WARNING:  ParadeDB: Cleaning up join execution
WARNING:  ParadeDB: Cleaning up join execution state
WARNING:  ParadeDB: ===== JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Search Results - Outer: 1, Inner: 1, Total Combinations: 1
WARNING:  ParadeDB: Join Processing - Matches: 1, Returned: 1, Success Rate: 100.0%
WARNING:  ParadeDB: Heap Tuple Access - Attempts: 2, Successes: 3, Success Rate: 150.0%
WARNING:  ParadeDB: Cleaned up 1 search readers
WARNING:  ParadeDB: Cleared 1 outer and 1 inner search results
WARNING:  ParadeDB: ===== END JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Join execution cleanup complete
 id |   title    |  filename  
----+------------+------------
  2 | Document 2 | Document 2
(1 row)

-- Cleanup
DROP TABLE documents_join_test CASCADE;
DROP TABLE files_join_test CASCADE; 
RESET paradedb.enable_custom_join;
