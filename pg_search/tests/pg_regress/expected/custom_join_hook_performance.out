-- Test performance and edge cases for custom join execution
-- This test validates various scenarios and edge cases
-- Create the extension first
CREATE EXTENSION IF NOT EXISTS pg_search;
-- Enable the custom join feature
SET paradedb.enable_custom_join = true;
-- Create test tables for performance testing
CREATE TABLE documents_perf (
    id SERIAL PRIMARY KEY,
    title TEXT,
    content TEXT,
    author TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
CREATE TABLE tags_perf (
    id SERIAL PRIMARY KEY,
    document_id INTEGER,
    tag_name TEXT,
    tag_value TEXT
);
-- Insert larger dataset for performance testing
INSERT INTO documents_perf (title, content, author) 
SELECT 
    'Document ' || i,
    'This is document number ' || i || ' with content about ' || 
    CASE (i % 5) 
        WHEN 0 THEN 'technology and innovation'
        WHEN 1 THEN 'science and research'
        WHEN 2 THEN 'business and finance'
        WHEN 3 THEN 'health and medicine'
        ELSE 'education and learning'
    END,
    'Author ' || ((i % 10) + 1)
FROM generate_series(1, 50) i;
INSERT INTO tags_perf (document_id, tag_name, tag_value)
SELECT 
    (i % 50) + 1,
    CASE (i % 4)
        WHEN 0 THEN 'category'
        WHEN 1 THEN 'priority'
        WHEN 2 THEN 'status'
        ELSE 'type'
    END,
    CASE (i % 3)
        WHEN 0 THEN 'high'
        WHEN 1 THEN 'medium'
        ELSE 'low'
    END
FROM generate_series(1, 100) i;
-- Create BM25 indexes
CREATE INDEX documents_perf_idx ON documents_perf USING bm25 (
    id,
    title,
    content,
    author
) WITH (
    key_field = 'id',
    text_fields = '{"title": {"tokenizer": {"type": "default"}}, "content": {"tokenizer": {"type": "default"}}, "author": {"tokenizer": {"type": "default"}}}'
);
CREATE INDEX tags_perf_idx ON tags_perf USING bm25 (
    id,
    document_id,
    tag_name,
    tag_value
) WITH (
    key_field = 'id',
    numeric_fields = '{"document_id": {"fast": true}}',
    text_fields = '{"tag_name": {"tokenizer": {"type": "default"}}, "tag_value": {"tokenizer": {"type": "default"}}}'
);
-- Test 1: Large result set join
SELECT COUNT(*) as total_matches
FROM documents_perf d
JOIN tags_perf t ON d.id = t.document_id
WHERE d.content @@@ 'technology OR science' AND t.tag_value @@@ 'high OR medium';
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["documents_perf"], inner relids: ["tags_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["documents_perf"], inner: ["tags_perf"]
WARNING:  ParadeDB: Extracted expected target list with 0 expressions from joinrel->reltarget
WARNING:  ParadeDB: Join path estimates - rows: 67, startup_cost: 50.00, total_cost: 50.34
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["tags_perf"], inner relids: ["documents_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["tags_perf"], inner: ["documents_perf"]
WARNING:  ParadeDB: Extracted expected target list with 0 expressions from joinrel->reltarget
WARNING:  ParadeDB: Join path estimates - rows: 67, startup_cost: 50.00, total_cost: 50.34
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 0 entries
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Stored outer relation OIDs: ["documents_perf"]
WARNING:  ParadeDB: Stored inner relation OIDs: ["tags_perf"]
WARNING:  ParadeDB: Storing 0 variable mappings from planning phase
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Join execution initialization complete
WARNING:  ParadeDB: Executing join step in phase: NotStarted
WARNING:  ParadeDB: Starting join execution
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1
WARNING:  ParadeDB: Outer predicate 0: relation=documents_perf, uses_search=true
WARNING:  ParadeDB: Inner predicate 0: relation=tags_perf, uses_search=true
WARNING:  ParadeDB: Initialized mock results - outer: 2, inner: 2
WARNING:  ParadeDB: Executing join step in phase: JoinMatching
WARNING:  ParadeDB: In join matching phase
WARNING:  ParadeDB: Current positions - outer: 0/2, inner: 0/2
WARNING:  ParadeDB: Matching and returning next tuple with join condition evaluation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("1")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("2")
WARNING:  ParadeDB: Iteration 1: outer[0] (ctid 1) × inner[0] (ctid 1) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: Advanced to next inner tuple [2/2] for outer [1]
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("1")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("3")
WARNING:  ParadeDB: Iteration 2: outer[0] (ctid 1) × inner[1] (ctid 2) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: Advanced to next outer tuple [2/2], reset inner to 0
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("2")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("2")
WARNING:  ParadeDB: Iteration 3: outer[1] (ctid 2) × inner[0] (ctid 1) = true
WARNING:  ParadeDB: Join condition satisfied - creating result tuple for outer[1] × inner[0] after 3 evaluations
WARNING:  ParadeDB: Creating join result tuple for outer[1], inner[0]
WARNING:  ParadeDB: Creating result tuple with 0 attributes
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Fetching real heap tuple values from relations documents_perf and tags_perf
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Detected relations from predicates - outer: 'documents_perf', inner: 'tags_perf'
WARNING:  ParadeDB: Fetching all columns with names from relation documents_perf with CTID 2
WARNING:  ParadeDB: documents_perf column 'id' = '2'
WARNING:  ParadeDB: documents_perf column 'title' = 'Document 2'
WARNING:  ParadeDB: documents_perf column 'content' = 'This is document number 2 with content about business and finance'
WARNING:  ParadeDB: documents_perf column 'author' = 'Author 3'
WARNING:  ParadeDB: documents_perf column 'created_at' = 'ERROR_TEXT_5'
WARNING:  ParadeDB: Successfully fetched 5 columns from documents_perf relation
WARNING:  ParadeDB: Fetching all columns with names from relation tags_perf with CTID 1
WARNING:  ParadeDB: tags_perf column 'id' = '1'
WARNING:  ParadeDB: tags_perf column 'document_id' = '2'
WARNING:  ParadeDB: tags_perf column 'tag_name' = 'priority'
WARNING:  ParadeDB: tags_perf column 'tag_value' = 'medium'
WARNING:  ParadeDB: Successfully fetched 4 columns from tags_perf relation
WARNING:  ParadeDB: Fetched 5 columns from outer relation, 4 from inner relation
WARNING:  ParadeDB: Mapped 0 out of 0 column values: []
WARNING:  ParadeDB: Created join result tuple with real heap data: []
WARNING:  ParadeDB: Advanced to next inner tuple [2/2] for outer [2]
WARNING:  ParadeDB: Executing join step in phase: JoinMatching
WARNING:  ParadeDB: In join matching phase
WARNING:  ParadeDB: Current positions - outer: 1/2, inner: 1/2
WARNING:  ParadeDB: Matching and returning next tuple with join condition evaluation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("2")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("3")
WARNING:  ParadeDB: Iteration 1: outer[1] (ctid 2) × inner[1] (ctid 2) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: All join combinations exhausted
WARNING:  ParadeDB: Join execution finished after advancing position
WARNING:  ParadeDB: Cleaning up join execution state
WARNING:  ParadeDB: Join execution cleanup complete
 total_matches 
---------------
             1
(1 row)

-- Test 2: Selective search (should return fewer results)
SELECT d.title, t.tag_name, t.tag_value
FROM documents_perf d
JOIN tags_perf t ON d.id = t.document_id
WHERE d.content @@@ 'innovation' AND t.tag_value @@@ 'high'
LIMIT 5;
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["documents_perf"], inner relids: ["tags_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["documents_perf"], inner: ["tags_perf"]
WARNING:  ParadeDB: Extracted expected target list with 3 expressions from joinrel->reltarget
WARNING:  ParadeDB: Stored target expression: {VAR :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 2 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 3 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 2 :varattno 4 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 4 :location -1}
WARNING:  ParadeDB: Stored 3 target expressions as strings
WARNING:  ParadeDB: Join path estimates - rows: 16, startup_cost: 50.00, total_cost: 50.08
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["tags_perf"], inner relids: ["documents_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["tags_perf"], inner: ["documents_perf"]
WARNING:  ParadeDB: Extracted expected target list with 3 expressions from joinrel->reltarget
WARNING:  ParadeDB: Stored target expression: {VAR :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 2 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 3 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 2 :varattno 4 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 4 :location -1}
WARNING:  ParadeDB: Stored 3 target expressions as strings
WARNING:  ParadeDB: Join path estimates - rows: 16, startup_cost: 50.00, total_cost: 50.08
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 3 entries
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=2 to 'join_attr_1'
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=3 to 'join_attr_2'
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=4 to 'join_attr_3'
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Stored outer relation OIDs: ["documents_perf"]
WARNING:  ParadeDB: Stored inner relation OIDs: ["tags_perf"]
WARNING:  ParadeDB: Storing 3 variable mappings from planning phase
WARNING:  ParadeDB: Planning-time mapping: varno=1, attno=2 -> 'join_attr_1'
WARNING:  ParadeDB: Planning-time mapping: varno=2, attno=3 -> 'join_attr_2'
WARNING:  ParadeDB: Planning-time mapping: varno=2, attno=4 -> 'join_attr_3'
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Join execution initialization complete
WARNING:  ParadeDB: Executing join step in phase: NotStarted
WARNING:  ParadeDB: Starting join execution
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1
WARNING:  ParadeDB: Outer predicate 0: relation=documents_perf, uses_search=true
WARNING:  ParadeDB: Inner predicate 0: relation=tags_perf, uses_search=true
WARNING:  ParadeDB: Initialized mock results - outer: 2, inner: 2
WARNING:  ParadeDB: Executing join step in phase: JoinMatching
WARNING:  ParadeDB: In join matching phase
WARNING:  ParadeDB: Current positions - outer: 0/2, inner: 0/2
WARNING:  ParadeDB: Matching and returning next tuple with join condition evaluation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("1")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("2")
WARNING:  ParadeDB: Iteration 1: outer[0] (ctid 1) × inner[0] (ctid 1) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: Advanced to next inner tuple [2/2] for outer [1]
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("1")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("3")
WARNING:  ParadeDB: Iteration 2: outer[0] (ctid 1) × inner[1] (ctid 2) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: Advanced to next outer tuple [2/2], reset inner to 0
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("2")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("2")
WARNING:  ParadeDB: Iteration 3: outer[1] (ctid 2) × inner[0] (ctid 1) = true
WARNING:  ParadeDB: Join condition satisfied - creating result tuple for outer[1] × inner[0] after 3 evaluations
WARNING:  ParadeDB: Creating join result tuple for outer[1], inner[0]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Fetching real heap tuple values from relations documents_perf and tags_perf
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Detected relations from predicates - outer: 'documents_perf', inner: 'tags_perf'
WARNING:  ParadeDB: Fetching all columns with names from relation documents_perf with CTID 2
WARNING:  ParadeDB: documents_perf column 'id' = '2'
WARNING:  ParadeDB: documents_perf column 'title' = 'Document 2'
WARNING:  ParadeDB: documents_perf column 'content' = 'This is document number 2 with content about business and finance'
WARNING:  ParadeDB: documents_perf column 'author' = 'Author 3'
WARNING:  ParadeDB: documents_perf column 'created_at' = 'ERROR_TEXT_5'
WARNING:  ParadeDB: Successfully fetched 5 columns from documents_perf relation
WARNING:  ParadeDB: Fetching all columns with names from relation tags_perf with CTID 1
WARNING:  ParadeDB: tags_perf column 'id' = '1'
WARNING:  ParadeDB: tags_perf column 'document_id' = '2'
WARNING:  ParadeDB: tags_perf column 'tag_name' = 'priority'
WARNING:  ParadeDB: tags_perf column 'tag_value' = 'medium'
WARNING:  ParadeDB: Successfully fetched 4 columns from tags_perf relation
WARNING:  ParadeDB: Fetched 5 columns from outer relation, 4 from inner relation
WARNING:  ParadeDB: Analyzing 3 target entries using execution-time varno/attno mapping: [(1, Some((Ok("{VAR :varno -3 :varattno 1 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1}"),))), (2, Some((Ok("{VAR :varno -3 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 3 :location -1}"),))), (3, Some((Ok("{VAR :varno -3 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 4 :location -1}"),)))]
WARNING:  ParadeDB: Mapped varno 4294967293 to outer relation documents_perf
WARNING:  ParadeDB: Built execution-time varno mapping with 1 entries: [(4294967293, "documents_perf")]
WARNING:  ParadeDB: Analyzing target entry 1 (resno: 1)
WARNING:  ParadeDB: Found Var in target entry 1 - varno: -3, attno: 1, varnosyn: 1, varattnosyn: 2
WARNING:  ParadeDB: Variable references INDEX/intermediate result, using varnosyn: 1, varattnosyn: 2
WARNING:  ParadeDB: Mapping original variable varnosyn: 1, varattnosyn: 2 to relation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Resolved varnosyn 1 to relation documents_perf
WARNING:  ParadeDB: varnosyn 1 resolved to relation documents_perf, attno 2
WARNING:  ParadeDB: Relation documents_perf attno 2 -> column name 'title'
WARNING:  ParadeDB: Target entry 1 mapped to: RelationColumn(documents_perf,title)
WARNING:  ParadeDB: Analyzing target entry 2 (resno: 2)
WARNING:  ParadeDB: Found Var in target entry 2 - varno: -3, attno: 2, varnosyn: 2, varattnosyn: 3
WARNING:  ParadeDB: Variable references INDEX/intermediate result, using varnosyn: 2, varattnosyn: 3
WARNING:  ParadeDB: Mapping original variable varnosyn: 2, varattnosyn: 3 to relation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Resolved varnosyn 2 to relation tags_perf
WARNING:  ParadeDB: varnosyn 2 resolved to relation tags_perf, attno 3
WARNING:  ParadeDB: Relation tags_perf attno 3 -> column name 'tag_name'
WARNING:  ParadeDB: Target entry 2 mapped to: RelationColumn(tags_perf,tag_name)
WARNING:  ParadeDB: Analyzing target entry 3 (resno: 3)
WARNING:  ParadeDB: Found Var in target entry 3 - varno: -3, attno: 3, varnosyn: 2, varattnosyn: 4
WARNING:  ParadeDB: Variable references INDEX/intermediate result, using varnosyn: 2, varattnosyn: 4
WARNING:  ParadeDB: Mapping original variable varnosyn: 2, varattnosyn: 4 to relation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Resolved varnosyn 2 to relation tags_perf
WARNING:  ParadeDB: varnosyn 2 resolved to relation tags_perf, attno 4
WARNING:  ParadeDB: Relation tags_perf attno 4 -> column name 'tag_value'
WARNING:  ParadeDB: Target entry 3 mapped to: RelationColumn(tags_perf,tag_value)
WARNING:  ParadeDB: Mapped 3 out of 3 column values: [Some("Document 2"), Some("priority"), Some("medium")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [Some("Document 2"), Some("priority"), Some("medium")]
WARNING:  ParadeDB: Advanced to next inner tuple [2/2] for outer [2]
WARNING:  ParadeDB: Executing join step in phase: JoinMatching
WARNING:  ParadeDB: In join matching phase
WARNING:  ParadeDB: Current positions - outer: 1/2, inner: 1/2
WARNING:  ParadeDB: Matching and returning next tuple with join condition evaluation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("2")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("3")
WARNING:  ParadeDB: Iteration 1: outer[1] (ctid 2) × inner[1] (ctid 2) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: All join combinations exhausted
WARNING:  ParadeDB: Join execution finished after advancing position
WARNING:  ParadeDB: Cleaning up join execution state
WARNING:  ParadeDB: Join execution cleanup complete
   title    | tag_name | tag_value 
------------+----------+-----------
 Document 2 | priority | medium
(1 row)

-- Test 3: Cross-product scenario (many-to-many)
SELECT COUNT(*) as cross_product_count
FROM documents_perf d
JOIN tags_perf t ON d.id = t.document_id
WHERE d.author @@@ 'Author' AND t.tag_name @@@ 'category OR priority';
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["documents_perf"], inner relids: ["tags_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["documents_perf"], inner: ["tags_perf"]
WARNING:  ParadeDB: Extracted expected target list with 0 expressions from joinrel->reltarget
WARNING:  ParadeDB: Join path estimates - rows: 125, startup_cost: 50.00, total_cost: 50.62
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["tags_perf"], inner relids: ["documents_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["tags_perf"], inner: ["documents_perf"]
WARNING:  ParadeDB: Extracted expected target list with 0 expressions from joinrel->reltarget
WARNING:  ParadeDB: Join path estimates - rows: 125, startup_cost: 50.00, total_cost: 50.62
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 0 entries
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Stored outer relation OIDs: ["documents_perf"]
WARNING:  ParadeDB: Stored inner relation OIDs: ["tags_perf"]
WARNING:  ParadeDB: Storing 0 variable mappings from planning phase
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Join execution initialization complete
WARNING:  ParadeDB: Executing join step in phase: NotStarted
WARNING:  ParadeDB: Starting join execution
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1
WARNING:  ParadeDB: Outer predicate 0: relation=documents_perf, uses_search=true
WARNING:  ParadeDB: Inner predicate 0: relation=tags_perf, uses_search=true
WARNING:  ParadeDB: Initialized mock results - outer: 2, inner: 2
WARNING:  ParadeDB: Executing join step in phase: JoinMatching
WARNING:  ParadeDB: In join matching phase
WARNING:  ParadeDB: Current positions - outer: 0/2, inner: 0/2
WARNING:  ParadeDB: Matching and returning next tuple with join condition evaluation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("1")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("2")
WARNING:  ParadeDB: Iteration 1: outer[0] (ctid 1) × inner[0] (ctid 1) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: Advanced to next inner tuple [2/2] for outer [1]
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("1")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("3")
WARNING:  ParadeDB: Iteration 2: outer[0] (ctid 1) × inner[1] (ctid 2) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: Advanced to next outer tuple [2/2], reset inner to 0
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("2")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("2")
WARNING:  ParadeDB: Iteration 3: outer[1] (ctid 2) × inner[0] (ctid 1) = true
WARNING:  ParadeDB: Join condition satisfied - creating result tuple for outer[1] × inner[0] after 3 evaluations
WARNING:  ParadeDB: Creating join result tuple for outer[1], inner[0]
WARNING:  ParadeDB: Creating result tuple with 0 attributes
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Fetching real heap tuple values from relations documents_perf and tags_perf
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Detected relations from predicates - outer: 'documents_perf', inner: 'tags_perf'
WARNING:  ParadeDB: Fetching all columns with names from relation documents_perf with CTID 2
WARNING:  ParadeDB: documents_perf column 'id' = '2'
WARNING:  ParadeDB: documents_perf column 'title' = 'Document 2'
WARNING:  ParadeDB: documents_perf column 'content' = 'This is document number 2 with content about business and finance'
WARNING:  ParadeDB: documents_perf column 'author' = 'Author 3'
WARNING:  ParadeDB: documents_perf column 'created_at' = 'ERROR_TEXT_5'
WARNING:  ParadeDB: Successfully fetched 5 columns from documents_perf relation
WARNING:  ParadeDB: Fetching all columns with names from relation tags_perf with CTID 1
WARNING:  ParadeDB: tags_perf column 'id' = '1'
WARNING:  ParadeDB: tags_perf column 'document_id' = '2'
WARNING:  ParadeDB: tags_perf column 'tag_name' = 'priority'
WARNING:  ParadeDB: tags_perf column 'tag_value' = 'medium'
WARNING:  ParadeDB: Successfully fetched 4 columns from tags_perf relation
WARNING:  ParadeDB: Fetched 5 columns from outer relation, 4 from inner relation
WARNING:  ParadeDB: Mapped 0 out of 0 column values: []
WARNING:  ParadeDB: Created join result tuple with real heap data: []
WARNING:  ParadeDB: Advanced to next inner tuple [2/2] for outer [2]
WARNING:  ParadeDB: Executing join step in phase: JoinMatching
WARNING:  ParadeDB: In join matching phase
WARNING:  ParadeDB: Current positions - outer: 1/2, inner: 1/2
WARNING:  ParadeDB: Matching and returning next tuple with join condition evaluation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("2")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("3")
WARNING:  ParadeDB: Iteration 1: outer[1] (ctid 2) × inner[1] (ctid 2) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: All join combinations exhausted
WARNING:  ParadeDB: Join execution finished after advancing position
WARNING:  ParadeDB: Cleaning up join execution state
WARNING:  ParadeDB: Join execution cleanup complete
 cross_product_count 
---------------------
                   1
(1 row)

-- Test 4: Empty result set
SELECT d.title, t.tag_value
FROM documents_perf d
JOIN tags_perf t ON d.id = t.document_id
WHERE d.content @@@ 'nonexistent_term' AND t.tag_value @@@ 'impossible_value';
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["documents_perf"], inner relids: ["tags_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["documents_perf"], inner: ["tags_perf"]
WARNING:  ParadeDB: Extracted expected target list with 2 expressions from joinrel->reltarget
WARNING:  ParadeDB: Stored target expression: {VAR :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 2 :varattno 4 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 4 :location -1}
WARNING:  ParadeDB: Stored 2 target expressions as strings
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 50.00, total_cost: 50.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["tags_perf"], inner relids: ["documents_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["tags_perf"], inner: ["documents_perf"]
WARNING:  ParadeDB: Extracted expected target list with 2 expressions from joinrel->reltarget
WARNING:  ParadeDB: Stored target expression: {VAR :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 2 :varattno 4 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 4 :location -1}
WARNING:  ParadeDB: Stored 2 target expressions as strings
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 50.00, total_cost: 50.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 2 entries
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=2 to 'join_attr_1'
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=4 to 'join_attr_2'
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Stored outer relation OIDs: ["documents_perf"]
WARNING:  ParadeDB: Stored inner relation OIDs: ["tags_perf"]
WARNING:  ParadeDB: Storing 2 variable mappings from planning phase
WARNING:  ParadeDB: Planning-time mapping: varno=1, attno=2 -> 'join_attr_1'
WARNING:  ParadeDB: Planning-time mapping: varno=2, attno=4 -> 'join_attr_2'
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Join execution initialization complete
WARNING:  ParadeDB: Executing join step in phase: NotStarted
WARNING:  ParadeDB: Starting join execution
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1
WARNING:  ParadeDB: Outer predicate 0: relation=documents_perf, uses_search=true
WARNING:  ParadeDB: Inner predicate 0: relation=tags_perf, uses_search=true
WARNING:  ParadeDB: Initialized mock results - outer: 2, inner: 2
WARNING:  ParadeDB: Executing join step in phase: JoinMatching
WARNING:  ParadeDB: In join matching phase
WARNING:  ParadeDB: Current positions - outer: 0/2, inner: 0/2
WARNING:  ParadeDB: Matching and returning next tuple with join condition evaluation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("1")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("2")
WARNING:  ParadeDB: Iteration 1: outer[0] (ctid 1) × inner[0] (ctid 1) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: Advanced to next inner tuple [2/2] for outer [1]
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("1")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("3")
WARNING:  ParadeDB: Iteration 2: outer[0] (ctid 1) × inner[1] (ctid 2) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: Advanced to next outer tuple [2/2], reset inner to 0
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("2")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("2")
WARNING:  ParadeDB: Iteration 3: outer[1] (ctid 2) × inner[0] (ctid 1) = true
WARNING:  ParadeDB: Join condition satisfied - creating result tuple for outer[1] × inner[0] after 3 evaluations
WARNING:  ParadeDB: Creating join result tuple for outer[1], inner[0]
WARNING:  ParadeDB: Creating result tuple with 2 attributes
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Fetching real heap tuple values from relations documents_perf and tags_perf
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Detected relations from predicates - outer: 'documents_perf', inner: 'tags_perf'
WARNING:  ParadeDB: Fetching all columns with names from relation documents_perf with CTID 2
WARNING:  ParadeDB: documents_perf column 'id' = '2'
WARNING:  ParadeDB: documents_perf column 'title' = 'Document 2'
WARNING:  ParadeDB: documents_perf column 'content' = 'This is document number 2 with content about business and finance'
WARNING:  ParadeDB: documents_perf column 'author' = 'Author 3'
WARNING:  ParadeDB: documents_perf column 'created_at' = 'ERROR_TEXT_5'
WARNING:  ParadeDB: Successfully fetched 5 columns from documents_perf relation
WARNING:  ParadeDB: Fetching all columns with names from relation tags_perf with CTID 1
WARNING:  ParadeDB: tags_perf column 'id' = '1'
WARNING:  ParadeDB: tags_perf column 'document_id' = '2'
WARNING:  ParadeDB: tags_perf column 'tag_name' = 'priority'
WARNING:  ParadeDB: tags_perf column 'tag_value' = 'medium'
WARNING:  ParadeDB: Successfully fetched 4 columns from tags_perf relation
WARNING:  ParadeDB: Fetched 5 columns from outer relation, 4 from inner relation
WARNING:  ParadeDB: Analyzing 2 target entries using execution-time varno/attno mapping: [(1, Some((Ok("{VAR :varno -3 :varattno 1 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1}"),))), (2, Some((Ok("{VAR :varno -3 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 4 :location -1}"),)))]
WARNING:  ParadeDB: Mapped varno 4294967293 to outer relation documents_perf
WARNING:  ParadeDB: Built execution-time varno mapping with 1 entries: [(4294967293, "documents_perf")]
WARNING:  ParadeDB: Analyzing target entry 1 (resno: 1)
WARNING:  ParadeDB: Found Var in target entry 1 - varno: -3, attno: 1, varnosyn: 1, varattnosyn: 2
WARNING:  ParadeDB: Variable references INDEX/intermediate result, using varnosyn: 1, varattnosyn: 2
WARNING:  ParadeDB: Mapping original variable varnosyn: 1, varattnosyn: 2 to relation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Resolved varnosyn 1 to relation documents_perf
WARNING:  ParadeDB: varnosyn 1 resolved to relation documents_perf, attno 2
WARNING:  ParadeDB: Relation documents_perf attno 2 -> column name 'title'
WARNING:  ParadeDB: Target entry 1 mapped to: RelationColumn(documents_perf,title)
WARNING:  ParadeDB: Analyzing target entry 2 (resno: 2)
WARNING:  ParadeDB: Found Var in target entry 2 - varno: -3, attno: 2, varnosyn: 2, varattnosyn: 4
WARNING:  ParadeDB: Variable references INDEX/intermediate result, using varnosyn: 2, varattnosyn: 4
WARNING:  ParadeDB: Mapping original variable varnosyn: 2, varattnosyn: 4 to relation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Resolved varnosyn 2 to relation tags_perf
WARNING:  ParadeDB: varnosyn 2 resolved to relation tags_perf, attno 4
WARNING:  ParadeDB: Relation tags_perf attno 4 -> column name 'tag_value'
WARNING:  ParadeDB: Target entry 2 mapped to: RelationColumn(tags_perf,tag_value)
WARNING:  ParadeDB: Mapped 2 out of 2 column values: [Some("Document 2"), Some("medium")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [Some("Document 2"), Some("medium")]
WARNING:  ParadeDB: Advanced to next inner tuple [2/2] for outer [2]
WARNING:  ParadeDB: Executing join step in phase: JoinMatching
WARNING:  ParadeDB: In join matching phase
WARNING:  ParadeDB: Current positions - outer: 1/2, inner: 1/2
WARNING:  ParadeDB: Matching and returning next tuple with join condition evaluation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("2")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("3")
WARNING:  ParadeDB: Iteration 1: outer[1] (ctid 2) × inner[1] (ctid 2) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: All join combinations exhausted
WARNING:  ParadeDB: Join execution finished after advancing position
WARNING:  ParadeDB: Cleaning up join execution state
WARNING:  ParadeDB: Join execution cleanup complete
   title    | tag_value 
------------+-----------
 Document 2 | medium
(1 row)

-- Test 5: Single result
SELECT d.title, d.author, t.tag_name
FROM documents_perf d
JOIN tags_perf t ON d.id = t.document_id
WHERE d.title @@@ 'Document 1' AND t.tag_value @@@ 'high'
LIMIT 1;
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["documents_perf"], inner relids: ["tags_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["documents_perf"], inner: ["tags_perf"]
WARNING:  ParadeDB: Extracted expected target list with 3 expressions from joinrel->reltarget
WARNING:  ParadeDB: Stored target expression: {VAR :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 1 :varattno 4 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 4 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 2 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 3 :location -1}
WARNING:  ParadeDB: Stored 3 target expressions as strings
WARNING:  ParadeDB: Join path estimates - rows: 82, startup_cost: 50.00, total_cost: 50.41
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["tags_perf"], inner relids: ["documents_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["tags_perf"], inner: ["documents_perf"]
WARNING:  ParadeDB: Extracted expected target list with 3 expressions from joinrel->reltarget
WARNING:  ParadeDB: Stored target expression: {VAR :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 1 :varattno 4 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 4 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 2 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 3 :location -1}
WARNING:  ParadeDB: Stored 3 target expressions as strings
WARNING:  ParadeDB: Join path estimates - rows: 82, startup_cost: 50.00, total_cost: 50.41
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 3 entries
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=2 to 'join_attr_1'
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=4 to 'join_attr_2'
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=3 to 'join_attr_3'
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Stored outer relation OIDs: ["documents_perf"]
WARNING:  ParadeDB: Stored inner relation OIDs: ["tags_perf"]
WARNING:  ParadeDB: Storing 3 variable mappings from planning phase
WARNING:  ParadeDB: Planning-time mapping: varno=1, attno=2 -> 'join_attr_1'
WARNING:  ParadeDB: Planning-time mapping: varno=2, attno=3 -> 'join_attr_3'
WARNING:  ParadeDB: Planning-time mapping: varno=1, attno=4 -> 'join_attr_2'
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Join execution initialization complete
WARNING:  ParadeDB: Executing join step in phase: NotStarted
WARNING:  ParadeDB: Starting join execution
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1
WARNING:  ParadeDB: Outer predicate 0: relation=documents_perf, uses_search=true
WARNING:  ParadeDB: Inner predicate 0: relation=tags_perf, uses_search=true
WARNING:  ParadeDB: Initialized mock results - outer: 2, inner: 2
WARNING:  ParadeDB: Executing join step in phase: JoinMatching
WARNING:  ParadeDB: In join matching phase
WARNING:  ParadeDB: Current positions - outer: 0/2, inner: 0/2
WARNING:  ParadeDB: Matching and returning next tuple with join condition evaluation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("1")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("2")
WARNING:  ParadeDB: Iteration 1: outer[0] (ctid 1) × inner[0] (ctid 1) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: Advanced to next inner tuple [2/2] for outer [1]
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("1")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("3")
WARNING:  ParadeDB: Iteration 2: outer[0] (ctid 1) × inner[1] (ctid 2) = false
WARNING:  ParadeDB: Join condition not satisfied - advancing to next combination
WARNING:  ParadeDB: Advanced to next outer tuple [2/2], reset inner to 0
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Determining join keys for relations documents_perf and tags_perf using extracted join conditions
WARNING:  ParadeDB: Found 1 extracted join conditions from query plan
WARNING:  ParadeDB: Checking join condition: RTI 1 (id) = RTI 2 (document_id)
WARNING:  ParadeDB: Mapped RTI 1 to relid Some("documents_perf"), RTI 2 to relid Some("tags_perf")
WARNING:  ParadeDB: Found matching join condition: documents_perf.id = tags_perf.document_id
WARNING:  ParadeDB: Fetching column 'id' from relation documents_perf with CTID 2
WARNING:  ParadeDB: Fetched column 'id' (attno 1) = Some("2")
WARNING:  ParadeDB: Fetching column 'document_id' from relation tags_perf with CTID 1
WARNING:  ParadeDB: Fetched column 'document_id' (attno 2) = Some("2")
WARNING:  ParadeDB: Iteration 3: outer[1] (ctid 2) × inner[0] (ctid 1) = true
WARNING:  ParadeDB: Join condition satisfied - creating result tuple for outer[1] × inner[0] after 3 evaluations
WARNING:  ParadeDB: Creating join result tuple for outer[1], inner[0]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Fetching real heap tuple values from relations documents_perf and tags_perf
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Detected relations from predicates - outer: 'documents_perf', inner: 'tags_perf'
WARNING:  ParadeDB: Fetching all columns with names from relation documents_perf with CTID 2
WARNING:  ParadeDB: documents_perf column 'id' = '2'
WARNING:  ParadeDB: documents_perf column 'title' = 'Document 2'
WARNING:  ParadeDB: documents_perf column 'content' = 'This is document number 2 with content about business and finance'
WARNING:  ParadeDB: documents_perf column 'author' = 'Author 3'
WARNING:  ParadeDB: documents_perf column 'created_at' = 'ERROR_TEXT_5'
WARNING:  ParadeDB: Successfully fetched 5 columns from documents_perf relation
WARNING:  ParadeDB: Fetching all columns with names from relation tags_perf with CTID 1
WARNING:  ParadeDB: tags_perf column 'id' = '1'
WARNING:  ParadeDB: tags_perf column 'document_id' = '2'
WARNING:  ParadeDB: tags_perf column 'tag_name' = 'priority'
WARNING:  ParadeDB: tags_perf column 'tag_value' = 'medium'
WARNING:  ParadeDB: Successfully fetched 4 columns from tags_perf relation
WARNING:  ParadeDB: Fetched 5 columns from outer relation, 4 from inner relation
WARNING:  ParadeDB: Analyzing 3 target entries using execution-time varno/attno mapping: [(1, Some((Ok("{VAR :varno -3 :varattno 1 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1}"),))), (2, Some((Ok("{VAR :varno -3 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 4 :location -1}"),))), (3, Some((Ok("{VAR :varno -3 :varattno 3 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 3 :location -1}"),)))]
WARNING:  ParadeDB: Mapped varno 4294967293 to outer relation documents_perf
WARNING:  ParadeDB: Built execution-time varno mapping with 1 entries: [(4294967293, "documents_perf")]
WARNING:  ParadeDB: Analyzing target entry 1 (resno: 1)
WARNING:  ParadeDB: Found Var in target entry 1 - varno: -3, attno: 1, varnosyn: 1, varattnosyn: 2
WARNING:  ParadeDB: Variable references INDEX/intermediate result, using varnosyn: 1, varattnosyn: 2
WARNING:  ParadeDB: Mapping original variable varnosyn: 1, varattnosyn: 2 to relation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Resolved varnosyn 1 to relation documents_perf
WARNING:  ParadeDB: varnosyn 1 resolved to relation documents_perf, attno 2
WARNING:  ParadeDB: Relation documents_perf attno 2 -> column name 'title'
WARNING:  ParadeDB: Target entry 1 mapped to: RelationColumn(documents_perf,title)
WARNING:  ParadeDB: Analyzing target entry 2 (resno: 2)
WARNING:  ParadeDB: Found Var in target entry 2 - varno: -3, attno: 2, varnosyn: 1, varattnosyn: 4
WARNING:  ParadeDB: Variable references INDEX/intermediate result, using varnosyn: 1, varattnosyn: 4
WARNING:  ParadeDB: Mapping original variable varnosyn: 1, varattnosyn: 4 to relation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Resolved varnosyn 1 to relation documents_perf
WARNING:  ParadeDB: varnosyn 1 resolved to relation documents_perf, attno 4
WARNING:  ParadeDB: Relation documents_perf attno 4 -> column name 'author'
WARNING:  ParadeDB: Target entry 2 mapped to: RelationColumn(documents_perf,author)
WARNING:  ParadeDB: Analyzing target entry 3 (resno: 3)
WARNING:  ParadeDB: Found Var in target entry 3 - varno: -3, attno: 3, varnosyn: 2, varattnosyn: 3
WARNING:  ParadeDB: Variable references INDEX/intermediate result, using varnosyn: 2, varattnosyn: 3
WARNING:  ParadeDB: Mapping original variable varnosyn: 2, varattnosyn: 3 to relation
WARNING:  ParadeDB: Using stored relation OIDs from join state - outer: documents_perf, inner: tags_perf
WARNING:  ParadeDB: Resolved varnosyn 2 to relation tags_perf
WARNING:  ParadeDB: varnosyn 2 resolved to relation tags_perf, attno 3
WARNING:  ParadeDB: Relation tags_perf attno 3 -> column name 'tag_name'
WARNING:  ParadeDB: Target entry 3 mapped to: RelationColumn(tags_perf,tag_name)
WARNING:  ParadeDB: Mapped 3 out of 3 column values: [Some("Document 2"), Some("Author 3"), Some("priority")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [Some("Document 2"), Some("Author 3"), Some("priority")]
WARNING:  ParadeDB: Advanced to next inner tuple [2/2] for outer [2]
WARNING:  ParadeDB: Cleaning up join execution state
WARNING:  ParadeDB: Join execution cleanup complete
   title    |  author  | tag_name 
------------+----------+----------
 Document 2 | Author 3 | priority
(1 row)

-- Test 6: EXPLAIN to see execution plan
EXPLAIN (COSTS OFF, BUFFERS OFF) 
SELECT d.title, t.tag_value
FROM documents_perf d
JOIN tags_perf t ON d.id = t.document_id
WHERE d.content @@@ 'technology' AND t.tag_value @@@ 'high';
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["documents_perf"], inner relids: ["tags_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["documents_perf"], inner: ["tags_perf"]
WARNING:  ParadeDB: Extracted expected target list with 2 expressions from joinrel->reltarget
WARNING:  ParadeDB: Stored target expression: {VAR :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 2 :varattno 4 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 4 :location -1}
WARNING:  ParadeDB: Stored 2 target expressions as strings
WARNING:  ParadeDB: Join path estimates - rows: 16, startup_cost: 50.00, total_cost: 50.08
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["tags_perf"], inner relids: ["documents_perf"]
WARNING:  ParadeDB: Both sides are base relations - proceeding with standard join
WARNING:  ParadeDB: Found BM25 index for relation tags_perf (rti 2)
WARNING:  ParadeDB: Checked relations ["tags_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Found BM25 index for relation documents_perf (rti 1)
WARNING:  ParadeDB: Checked relations ["documents_perf"] for BM25 indexes, found: true
WARNING:  ParadeDB: Join feasibility check - outer has BM25: true, inner has BM25: true
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Extracted join condition: 1.id = 2.document_id
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation tags_perf (rti 2)
WARNING:  ParadeDB: Extracted search query for tags_perf: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation documents_perf (rti 1)
WARNING:  ParadeDB: Extracted search query for documents_perf: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 1 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Join is feasible based on composite analysis: BothBaseRelations
WARNING:  ParadeDB: Outer predicate for tags_perf - uses_search: true
WARNING:  ParadeDB: Inner predicate for documents_perf - uses_search: true
WARNING:  ParadeDB: Bilateral search detected - proceeding with custom join path
WARNING:  ParadeDB: Storing join relation OIDs - outer: ["tags_perf"], inner: ["documents_perf"]
WARNING:  ParadeDB: Extracted expected target list with 2 expressions from joinrel->reltarget
WARNING:  ParadeDB: Stored target expression: {VAR :varno 1 :varattno 2 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 1 :varattnosyn 2 :location -1}
WARNING:  ParadeDB: Stored target expression: {VAR :varno 2 :varattno 4 :vartype 25 :vartypmod -1 :varcollid 100 :varnullingrels (b) :varlevelsup 0 :varnosyn 2 :varattnosyn 4 :location -1}
WARNING:  ParadeDB: Stored 2 target expressions as strings
WARNING:  ParadeDB: Join path estimates - rows: 16, startup_cost: 50.00, total_cost: 50.08
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 2 entries
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=2 to 'join_attr_1'
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=4 to 'join_attr_2'
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Stored outer relation OIDs: ["documents_perf"]
WARNING:  ParadeDB: Stored inner relation OIDs: ["tags_perf"]
WARNING:  ParadeDB: Storing 2 variable mappings from planning phase
WARNING:  ParadeDB: Planning-time mapping: varno=1, attno=2 -> 'join_attr_1'
WARNING:  ParadeDB: Planning-time mapping: varno=2, attno=4 -> 'join_attr_2'
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Join execution initialization complete
ERROR:  called `Option::unwrap()` on a `None` value
-- Cleanup
DROP TABLE documents_perf CASCADE;
DROP TABLE tags_perf CASCADE;
RESET paradedb.enable_custom_join; 
