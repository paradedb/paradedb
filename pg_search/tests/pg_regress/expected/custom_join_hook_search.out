-- Test search integration in custom joins
-- This test focuses on validating search predicate extraction and execution
-- Create the extension first
CREATE EXTENSION IF NOT EXISTS pg_search;
-- Enable the custom join feature
SET paradedb.enable_custom_join = true;
-- Create test tables with more realistic data
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name TEXT,
    description TEXT,
    category TEXT
);
CREATE TABLE reviews (
    id SERIAL PRIMARY KEY,
    product_id INTEGER,
    reviewer_name TEXT,
    review_text TEXT,
    rating INTEGER
);
-- Insert test data with search-friendly content
INSERT INTO products (name, description, category) VALUES 
    ('Laptop Pro', 'High-performance laptop with advanced features for professionals', 'Electronics'),
    ('Wireless Mouse', 'Ergonomic wireless mouse with precision tracking', 'Electronics'),
    ('Coffee Maker', 'Automatic coffee maker with programmable settings', 'Kitchen'),
    ('Running Shoes', 'Lightweight running shoes with excellent cushioning', 'Sports'),
    ('Smartphone X', 'Latest smartphone with cutting-edge technology', 'Electronics');
INSERT INTO reviews (product_id, reviewer_name, review_text, rating) VALUES 
    (1, 'John Doe', 'Excellent laptop with amazing performance and battery life', 5),
    (1, 'Jane Smith', 'Great for professional work, highly recommended', 4),
    (2, 'Bob Wilson', 'Perfect wireless mouse, very responsive and comfortable', 5),
    (3, 'Alice Brown', 'Makes excellent coffee every morning, love the programmable features', 4),
    (4, 'Charlie Davis', 'Best running shoes I have ever owned, great cushioning', 5),
    (5, 'Eva Martinez', 'Amazing smartphone with incredible camera and performance', 5);
-- Create BM25 indexes
CREATE INDEX products_search_idx ON products USING bm25 (
    id,
    name,
    description,
    category
) WITH (
    key_field = 'id',
    text_fields = '{"name": {"tokenizer": {"type": "default"}}, "description": {"tokenizer": {"type": "default"}}, "category": {"tokenizer": {"type": "default"}}}'
);
CREATE INDEX reviews_search_idx ON reviews USING bm25 (
    id,
    product_id,
    reviewer_name,
    review_text,
    rating
) WITH (
    key_field = 'id',
    numeric_fields = '{"product_id": {"fast": true}, "rating": {"fast": true}}',
    text_fields = '{"reviewer_name": {"tokenizer": {"type": "default"}}, "review_text": {"tokenizer": {"type": "default"}}}'
);
-- Test 1: Bilateral search join (both sides have search predicates)
-- This should trigger our custom join with real search predicates
SELECT p.name, r.reviewer_name, r.review_text
FROM products p
JOIN reviews r ON p.id = r.product_id
WHERE p.description @@@ 'performance' AND r.review_text @@@ 'excellent';
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["products"], inner relids: ["reviews"]
WARNING:  ParadeDB: Checking relation products (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation products
WARNING:  ParadeDB: Checking relation reviews (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation reviews
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation products (rti 1)
WARNING:  ParadeDB: Extracted search query for products: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation reviews (rti 2)
WARNING:  ParadeDB: Extracted search query for reviews: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for products - uses_search: true
WARNING:  ParadeDB: Inner predicate for reviews - uses_search: true
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["reviews"], inner relids: ["products"]
WARNING:  ParadeDB: Checking relation reviews (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation reviews
WARNING:  ParadeDB: Checking relation products (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation products
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation reviews (rti 2)
WARNING:  ParadeDB: Extracted search query for reviews: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation products (rti 1)
WARNING:  ParadeDB: Extracted search query for products: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for reviews - uses_search: true
WARNING:  ParadeDB: Inner predicate for products - uses_search: true
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 3 entries
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=2 to join_attr_1
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=3 to join_attr_2
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=4 to join_attr_3
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Using stored search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Creating join tuple descriptor with 3 columns
WARNING:  ParadeDB: Tuple descriptor created successfully
WARNING:  ParadeDB: Join execution initialized with 3 target columns
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Starting join execution - initializing search
WARNING:  ParadeDB: Initializing real search execution for join
WARNING:  ParadeDB: Join execution state found
WARNING:  ParadeDB: Search predicates found in join state - outer: 1, inner: 1
WARNING:  ParadeDB: Retrieved search predicates from join state - outer: 1, inner: 1
WARNING:  ParadeDB: Initializing search readers for join relations
WARNING:  ParadeDB: Opening search reader for outer relation products
WARNING:  ParadeDB: Successfully opened search reader for products
WARNING:  ParadeDB: Opening search reader for inner relation reviews
WARNING:  ParadeDB: Successfully opened search reader for reviews
WARNING:  ParadeDB: Initialized 2 search readers
WARNING:  ParadeDB: Executing real searches on join relations
WARNING:  ParadeDB: Executing search on outer relation products
WARNING:  ParadeDB: Executing real BM25 search on relation products
WARNING:  ParadeDB: Real search on products returned 1 results
WARNING:  ParadeDB: Found 1 results for outer relation products in 766μs
WARNING:  ParadeDB: Executing search on inner relation reviews (72605)
WARNING:  ParadeDB: Executing real BM25 search on relation reviews
WARNING:  ParadeDB: Real search on reviews returned 2 results
WARNING:  ParadeDB: Found 2 results for inner relation reviews in 553μs
WARNING:  ParadeDB: Completed real search execution in 1445μs - outer: 1, inner: 2
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing outer search
WARNING:  ParadeDB: Executing search on outer relation
WARNING:  ParadeDB: Outer search completed - 1 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing inner search
WARNING:  ParadeDB: Executing search on inner relation
WARNING:  ParadeDB: Inner search completed - 2 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [1/1] × [1/2]
WARNING:  ParadeDB: Creating join result tuple for outer[0], inner[0]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 1 and 1 from relations Some(72596) and Some(72605)
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Laptop Pro'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'High-performance laptop with advanced features for professionals'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 515μs: [None, Some("Laptop Pro"), Some("High-performance laptop with advanced features for professionals")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Laptop Pro"), Some("High-performance laptop with advanced features for professionals")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [1/1] × [2/2]
WARNING:  ParadeDB: Creating join result tuple for outer[0], inner[1]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 1 and 4 from relations Some(72596) and Some(72605)
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Laptop Pro'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'High-performance laptop with advanced features for professionals'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 386μs: [None, Some("Laptop Pro"), Some("High-performance laptop with advanced features for professionals")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Laptop Pro"), Some("High-performance laptop with advanced features for professionals")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Join matching complete - total matches: 2, total time: 1228μs
WARNING:  ParadeDB: Cleaning up join execution
WARNING:  ParadeDB: Cleaning up join execution state
WARNING:  ParadeDB: ===== JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Search Results - Outer: 1, Inner: 2, Total Combinations: 2
WARNING:  ParadeDB: Join Processing - Matches: 2, Returned: 2, Success Rate: 100.0%
WARNING:  ParadeDB: Performance Timing - Search: 1319μs, Matching: 1228μs, Total: 2547μs
WARNING:  ParadeDB: Search Breakdown - Outer: 766μs, Inner: 553μs
WARNING:  ParadeDB: Heap Tuple Access - Attempts: 4, Successes: 4, Success Rate: 100.0%
WARNING:  ParadeDB: Efficiency Metrics - Avg Match Time: 614μs, Throughput: 0.8 matches/ms
WARNING:  ParadeDB: Cleaned up 2 search readers
WARNING:  ParadeDB: Cleared 1 outer and 2 inner search results
WARNING:  ParadeDB: ===== END JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Join execution cleanup complete
 name | reviewer_name |                           review_text                            
------+---------------+------------------------------------------------------------------
      | Laptop Pro    | High-performance laptop with advanced features for professionals
      | Laptop Pro    | High-performance laptop with advanced features for professionals
(2 rows)

-- Test 2: Single-sided search join (only one side has search predicate)
SELECT p.name, r.reviewer_name, r.rating
FROM products p
JOIN reviews r ON p.id = r.product_id
WHERE p.category @@@ 'Electronics';
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["products"], inner relids: ["reviews"]
WARNING:  ParadeDB: Checking relation products (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation products
WARNING:  ParadeDB: Checking relation reviews (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation reviews
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation products (rti 1)
WARNING:  ParadeDB: Extracted search query for products: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 0 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 0, bilateral: false
WARNING:  ParadeDB: Outer predicate for products - uses_search: true
WARNING:  ParadeDB: Join path estimates - rows: 2, startup_cost: 100.00, total_cost: 100.02
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["reviews"], inner relids: ["products"]
WARNING:  ParadeDB: Checking relation reviews (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation reviews
WARNING:  ParadeDB: Checking relation products (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation products
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation products (rti 1)
WARNING:  ParadeDB: Extracted search query for products: uses_search_operator=true
WARNING:  ParadeDB: Extracted 0 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 0, inner: 1, bilateral: false
WARNING:  ParadeDB: Inner predicate for products - uses_search: true
WARNING:  ParadeDB: Join path estimates - rows: 2, startup_cost: 100.00, total_cost: 100.02
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 3 entries
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=2 to join_attr_1
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=3 to join_attr_2
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=5 to join_attr_3
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 0, bilateral: false
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Using stored search predicates - outer: 1, inner: 0, bilateral: false
WARNING:  ParadeDB: Creating join tuple descriptor with 3 columns
WARNING:  ParadeDB: Tuple descriptor created successfully
WARNING:  ParadeDB: Join execution initialized with 3 target columns
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Starting join execution - initializing search
WARNING:  ParadeDB: Initializing real search execution for join
WARNING:  ParadeDB: Join execution state found
WARNING:  ParadeDB: Search predicates found in join state - outer: 1, inner: 0
WARNING:  ParadeDB: Retrieved search predicates from join state - outer: 1, inner: 0
WARNING:  ParadeDB: Initializing search readers for join relations
WARNING:  ParadeDB: Opening search reader for outer relation products
WARNING:  ParadeDB: Successfully opened search reader for products
WARNING:  ParadeDB: Initialized 1 search readers
WARNING:  ParadeDB: Executing real searches on join relations
WARNING:  ParadeDB: Executing search on outer relation products
WARNING:  ParadeDB: Executing real BM25 search on relation products
WARNING:  ParadeDB: Real search on products returned 3 results
WARNING:  ParadeDB: Found 3 results for outer relation products in 602μs
WARNING:  ParadeDB: No inner search results, using default result
WARNING:  ParadeDB: Completed real search execution in 682μs - outer: 3, inner: 1
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing outer search
WARNING:  ParadeDB: Executing search on outer relation
WARNING:  ParadeDB: Outer search completed - 3 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing inner search
WARNING:  ParadeDB: Executing search on inner relation
WARNING:  ParadeDB: Inner search completed - 1 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [1/3] × [1/1]
WARNING:  ParadeDB: Creating join result tuple for outer[0], inner[0]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 1 and 1 from relations Some(72596) and None
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Laptop Pro'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'High-performance laptop with advanced features for professionals'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 405μs: [None, Some("Laptop Pro"), Some("High-performance laptop with advanced features for professionals")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Laptop Pro"), Some("High-performance laptop with advanced features for professionals")]
WARNING:  ParadeDB: Advanced to next outer tuple [2/3]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [2/3] × [1/1]
WARNING:  ParadeDB: Creating join result tuple for outer[1], inner[0]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 2 and 1 from relations Some(72596) and None
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Wireless Mouse'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'Ergonomic wireless mouse with precision tracking'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 402μs: [None, Some("Wireless Mouse"), Some("Ergonomic wireless mouse with precision tracking")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Wireless Mouse"), Some("Ergonomic wireless mouse with precision tracking")]
WARNING:  ParadeDB: Advanced to next outer tuple [3/3]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [3/3] × [1/1]
WARNING:  ParadeDB: Creating join result tuple for outer[2], inner[0]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 5 and 1 from relations Some(72596) and None
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Smartphone X'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'Latest smartphone with cutting-edge technology'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 429μs: [None, Some("Smartphone X"), Some("Latest smartphone with cutting-edge technology")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Smartphone X"), Some("Latest smartphone with cutting-edge technology")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Join matching complete - total matches: 3, total time: 1754μs
WARNING:  ParadeDB: Cleaning up join execution
WARNING:  ParadeDB: Cleaning up join execution state
WARNING:  ParadeDB: ===== JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Search Results - Outer: 3, Inner: 1, Total Combinations: 3
WARNING:  ParadeDB: Join Processing - Matches: 3, Returned: 3, Success Rate: 100.0%
WARNING:  ParadeDB: Performance Timing - Search: 602μs, Matching: 1754μs, Total: 2356μs
WARNING:  ParadeDB: Search Breakdown - Outer: 602μs, Inner: 0μs
WARNING:  ParadeDB: Heap Tuple Access - Attempts: 6, Successes: 6, Success Rate: 100.0%
WARNING:  ParadeDB: Efficiency Metrics - Avg Match Time: 584μs, Throughput: 1.3 matches/ms
WARNING:  ParadeDB: Cleaned up 1 search readers
WARNING:  ParadeDB: Cleared 3 outer and 1 inner search results
WARNING:  ParadeDB: ===== END JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Join execution cleanup complete
 name | reviewer_name  |                              rating                              
------+----------------+------------------------------------------------------------------
      | Laptop Pro     | High-performance laptop with advanced features for professionals
      | Wireless Mouse |                 Ergonomic wireless mouse with precision tracking
      | Smartphone X   |                   Latest smartphone with cutting-edge technology
(3 rows)

-- Test 3: Complex search with multiple terms
SELECT p.name, p.description, r.review_text
FROM products p
JOIN reviews r ON p.id = r.product_id
WHERE p.description @@@ 'wireless OR smartphone' AND r.review_text @@@ 'amazing OR perfect';
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["products"], inner relids: ["reviews"]
WARNING:  ParadeDB: Checking relation products (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation products
WARNING:  ParadeDB: Checking relation reviews (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation reviews
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation products (rti 1)
WARNING:  ParadeDB: Extracted search query for products: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation reviews (rti 2)
WARNING:  ParadeDB: Extracted search query for reviews: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for products - uses_search: true
WARNING:  ParadeDB: Inner predicate for reviews - uses_search: true
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["reviews"], inner relids: ["products"]
WARNING:  ParadeDB: Checking relation reviews (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation reviews
WARNING:  ParadeDB: Checking relation products (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation products
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation reviews (rti 2)
WARNING:  ParadeDB: Extracted search query for reviews: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation products (rti 1)
WARNING:  ParadeDB: Extracted search query for products: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for reviews - uses_search: true
WARNING:  ParadeDB: Inner predicate for products - uses_search: true
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 3 entries
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=2 to join_attr_1
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=3 to join_attr_2
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=4 to join_attr_3
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Using stored search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Creating join tuple descriptor with 3 columns
WARNING:  ParadeDB: Tuple descriptor created successfully
WARNING:  ParadeDB: Join execution initialized with 3 target columns
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Starting join execution - initializing search
WARNING:  ParadeDB: Initializing real search execution for join
WARNING:  ParadeDB: Join execution state found
WARNING:  ParadeDB: Search predicates found in join state - outer: 1, inner: 1
WARNING:  ParadeDB: Retrieved search predicates from join state - outer: 1, inner: 1
WARNING:  ParadeDB: Initializing search readers for join relations
WARNING:  ParadeDB: Opening search reader for outer relation products
WARNING:  ParadeDB: Successfully opened search reader for products
WARNING:  ParadeDB: Opening search reader for inner relation reviews
WARNING:  ParadeDB: Successfully opened search reader for reviews
WARNING:  ParadeDB: Initialized 2 search readers
WARNING:  ParadeDB: Executing real searches on join relations
WARNING:  ParadeDB: Executing search on outer relation products
WARNING:  ParadeDB: Executing real BM25 search on relation products
WARNING:  ParadeDB: Real search on products returned 2 results
WARNING:  ParadeDB: Found 2 results for outer relation products in 806μs
WARNING:  ParadeDB: Executing search on inner relation reviews (72605)
WARNING:  ParadeDB: Executing real BM25 search on relation reviews
WARNING:  ParadeDB: Real search on reviews returned 3 results
WARNING:  ParadeDB: Found 3 results for inner relation reviews in 652μs
WARNING:  ParadeDB: Completed real search execution in 1565μs - outer: 2, inner: 3
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing outer search
WARNING:  ParadeDB: Executing search on outer relation
WARNING:  ParadeDB: Outer search completed - 2 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing inner search
WARNING:  ParadeDB: Executing search on inner relation
WARNING:  ParadeDB: Inner search completed - 3 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [1/2] × [1/3]
WARNING:  ParadeDB: Creating join result tuple for outer[0], inner[0]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 2 and 1 from relations Some(72596) and Some(72605)
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Wireless Mouse'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'Ergonomic wireless mouse with precision tracking'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 413μs: [None, Some("Wireless Mouse"), Some("Ergonomic wireless mouse with precision tracking")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Wireless Mouse"), Some("Ergonomic wireless mouse with precision tracking")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [1/2] × [2/3]
WARNING:  ParadeDB: Creating join result tuple for outer[0], inner[1]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 2 and 3 from relations Some(72596) and Some(72605)
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Wireless Mouse'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'Ergonomic wireless mouse with precision tracking'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 417μs: [None, Some("Wireless Mouse"), Some("Ergonomic wireless mouse with precision tracking")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Wireless Mouse"), Some("Ergonomic wireless mouse with precision tracking")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [1/2] × [3/3]
WARNING:  ParadeDB: Creating join result tuple for outer[0], inner[2]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 2 and 6 from relations Some(72596) and Some(72605)
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Wireless Mouse'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 2
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'Ergonomic wireless mouse with precision tracking'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 397μs: [None, Some("Wireless Mouse"), Some("Ergonomic wireless mouse with precision tracking")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Wireless Mouse"), Some("Ergonomic wireless mouse with precision tracking")]
WARNING:  ParadeDB: Advanced to next outer tuple [2/2]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [2/2] × [1/3]
WARNING:  ParadeDB: Creating join result tuple for outer[1], inner[0]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 5 and 1 from relations Some(72596) and Some(72605)
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Smartphone X'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'Latest smartphone with cutting-edge technology'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 416μs: [None, Some("Smartphone X"), Some("Latest smartphone with cutting-edge technology")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Smartphone X"), Some("Latest smartphone with cutting-edge technology")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [2/2] × [2/3]
WARNING:  ParadeDB: Creating join result tuple for outer[1], inner[1]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 5 and 3 from relations Some(72596) and Some(72605)
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Smartphone X'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'Latest smartphone with cutting-edge technology'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 431μs: [None, Some("Smartphone X"), Some("Latest smartphone with cutting-edge technology")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Smartphone X"), Some("Latest smartphone with cutting-edge technology")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [2/2] × [3/3]
WARNING:  ParadeDB: Creating join result tuple for outer[1], inner[2]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 5 and 6 from relations Some(72596) and Some(72605)
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Smartphone X'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 5
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'Latest smartphone with cutting-edge technology'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 459μs: [None, Some("Smartphone X"), Some("Latest smartphone with cutting-edge technology")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Smartphone X"), Some("Latest smartphone with cutting-edge technology")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Join matching complete - total matches: 6, total time: 3458μs
WARNING:  ParadeDB: Cleaning up join execution
WARNING:  ParadeDB: Cleaning up join execution state
WARNING:  ParadeDB: ===== JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Search Results - Outer: 2, Inner: 3, Total Combinations: 6
WARNING:  ParadeDB: Join Processing - Matches: 6, Returned: 6, Success Rate: 100.0%
WARNING:  ParadeDB: Performance Timing - Search: 1458μs, Matching: 3458μs, Total: 4916μs
WARNING:  ParadeDB: Search Breakdown - Outer: 806μs, Inner: 652μs
WARNING:  ParadeDB: Heap Tuple Access - Attempts: 12, Successes: 12, Success Rate: 100.0%
WARNING:  ParadeDB: Efficiency Metrics - Avg Match Time: 576μs, Throughput: 1.2 matches/ms
WARNING:  ParadeDB: Cleaned up 2 search readers
WARNING:  ParadeDB: Cleared 2 outer and 3 inner search results
WARNING:  ParadeDB: ===== END JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Join execution cleanup complete
 name |  description   |                   review_text                    
------+----------------+--------------------------------------------------
      | Wireless Mouse | Ergonomic wireless mouse with precision tracking
      | Wireless Mouse | Ergonomic wireless mouse with precision tracking
      | Wireless Mouse | Ergonomic wireless mouse with precision tracking
      | Smartphone X   | Latest smartphone with cutting-edge technology
      | Smartphone X   | Latest smartphone with cutting-edge technology
      | Smartphone X   | Latest smartphone with cutting-edge technology
(6 rows)

-- Test 4: Search with numeric conditions (should still trigger custom join)
SELECT p.name, r.review_text, r.rating
FROM products p
JOIN reviews r ON p.id = r.product_id
WHERE p.description @@@ 'laptop' AND r.rating >= 4;
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["products"], inner relids: ["reviews"]
WARNING:  ParadeDB: Checking relation products (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation products
WARNING:  ParadeDB: Checking relation reviews (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation reviews
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation products (rti 1)
WARNING:  ParadeDB: Extracted search query for products: uses_search_operator=true
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation reviews (rti 2)
WARNING:  ParadeDB: Extracted search query for reviews: uses_search_operator=false
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for products - uses_search: true
WARNING:  ParadeDB: Inner predicate for reviews - uses_search: false
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["reviews"], inner relids: ["products"]
WARNING:  ParadeDB: Checking relation reviews (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation reviews
WARNING:  ParadeDB: Checking relation products (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation products
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Found 1 join restriction clauses
WARNING:  ParadeDB: Analyzing join clause of type T_OpExpr
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation reviews (rti 2)
WARNING:  ParadeDB: Extracted search query for reviews: uses_search_operator=false
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation products (rti 1)
WARNING:  ParadeDB: Extracted search query for products: uses_search_operator=true
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for reviews - uses_search: false
WARNING:  ParadeDB: Inner predicate for products - uses_search: true
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Planning custom join path with scanrelid = 0
WARNING:  ParadeDB: Join target list has 3 entries
WARNING:  ParadeDB: Mapped join variable varno=1, varattno=2 to join_attr_1
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=4 to join_attr_2
WARNING:  ParadeDB: Mapped join variable varno=2, varattno=5 to join_attr_3
WARNING:  ParadeDB: Set custom scan target list for join node
WARNING:  ParadeDB: Creating custom scan state for join node (scanrelid = 0)
WARNING:  ParadeDB: Extracted search predicates from private data - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Beginning custom scan for join node
WARNING:  ParadeDB: Initializing join execution
WARNING:  ParadeDB: Using stored search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Creating join tuple descriptor with 3 columns
WARNING:  ParadeDB: Tuple descriptor created successfully
WARNING:  ParadeDB: Join execution initialized with 3 target columns
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Starting join execution - initializing search
WARNING:  ParadeDB: Initializing real search execution for join
WARNING:  ParadeDB: Join execution state found
WARNING:  ParadeDB: Search predicates found in join state - outer: 1, inner: 1
WARNING:  ParadeDB: Retrieved search predicates from join state - outer: 1, inner: 1
WARNING:  ParadeDB: Initializing search readers for join relations
WARNING:  ParadeDB: Opening search reader for outer relation products
WARNING:  ParadeDB: Successfully opened search reader for products
WARNING:  ParadeDB: Initialized 1 search readers
WARNING:  ParadeDB: Executing real searches on join relations
WARNING:  ParadeDB: Executing search on outer relation products
WARNING:  ParadeDB: Executing real BM25 search on relation products
WARNING:  ParadeDB: Real search on products returned 1 results
WARNING:  ParadeDB: Found 1 results for outer relation products in 537μs
WARNING:  ParadeDB: No inner search results, using default result
WARNING:  ParadeDB: Completed real search execution in 612μs - outer: 1, inner: 1
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing outer search
WARNING:  ParadeDB: Executing search on outer relation
WARNING:  ParadeDB: Outer search completed - 1 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Executing inner search
WARNING:  ParadeDB: Executing search on inner relation
WARNING:  ParadeDB: Inner search completed - 1 results
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Processing join match [1/1] × [1/1]
WARNING:  ParadeDB: Creating join result tuple for outer[0], inner[0]
WARNING:  ParadeDB: Creating result tuple with 3 attributes
WARNING:  ParadeDB: Fetching real heap tuple values for CTIDs 1 and 1 from relations Some(72596) and Some(72605)
WARNING:  ParadeDB: Processing target entry 1 - varno: 4294967293, varattno: 1
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=1
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=1
WARNING:  ParadeDB: Fetching column 1 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Error getting outer column 1 ('id'): IncompatibleTypes { rust_type: "alloc::string::String", rust_oid: 25, datum_type: "integer", datum_oid: 23 }
WARNING:  ParadeDB: Processing target entry 2 - varno: 4294967293, varattno: 2
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=2
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=2
WARNING:  ParadeDB: Fetching column 2 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Successfully fetched outer column 2 ('name') = 'Laptop Pro'
WARNING:  ParadeDB: Processing target entry 3 - varno: 4294967293, varattno: 3
WARNING:  ParadeDB: Looking up variable mapping for varno=4294967293, varattno=3
WARNING:  ParadeDB: No variable mapping found for varno=4294967293, varattno=3
WARNING:  ParadeDB: Fetching column 3 from outer relation 72596 with CTID 1
WARNING:  ParadeDB: Successfully fetched outer column 3 ('description') = 'High-performance laptop with advanced features for professionals'
WARNING:  ParadeDB: Fetched 2 out of 3 column values in 433μs: [None, Some("Laptop Pro"), Some("High-performance laptop with advanced features for professionals")]
WARNING:  ParadeDB: Created join result tuple with real heap data: [None, Some("Laptop Pro"), Some("High-performance laptop with advanced features for professionals")]
WARNING:  ParadeDB: Executing join step
WARNING:  ParadeDB: Performing join matching
WARNING:  ParadeDB: Matching and returning next tuple
WARNING:  ParadeDB: Join matching complete - total matches: 1, total time: 602μs
WARNING:  ParadeDB: Cleaning up join execution
WARNING:  ParadeDB: Cleaning up join execution state
WARNING:  ParadeDB: ===== JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Search Results - Outer: 1, Inner: 1, Total Combinations: 1
WARNING:  ParadeDB: Join Processing - Matches: 1, Returned: 1, Success Rate: 100.0%
WARNING:  ParadeDB: Performance Timing - Search: 537μs, Matching: 602μs, Total: 1139μs
WARNING:  ParadeDB: Search Breakdown - Outer: 537μs, Inner: 0μs
WARNING:  ParadeDB: Heap Tuple Access - Attempts: 2, Successes: 2, Success Rate: 100.0%
WARNING:  ParadeDB: Efficiency Metrics - Avg Match Time: 602μs, Throughput: 0.9 matches/ms
WARNING:  ParadeDB: Cleaned up 1 search readers
WARNING:  ParadeDB: Cleared 1 outer and 1 inner search results
WARNING:  ParadeDB: ===== END JOIN EXECUTION STATISTICS =====
WARNING:  ParadeDB: Join execution cleanup complete
 name | review_text |                              rating                              
------+-------------+------------------------------------------------------------------
      | Laptop Pro  | High-performance laptop with advanced features for professionals
(1 row)

-- Test 5: No search predicates (should use regular join)
SELECT p.name, r.reviewer_name
FROM products p
JOIN reviews r ON p.id = r.product_id
WHERE p.id = 1;
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["products"], inner relids: ["reviews"]
WARNING:  ParadeDB: Checking relation products (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation products
WARNING:  ParadeDB: Checking relation reviews (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation reviews
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation products (rti 1)
WARNING:  ParadeDB: Extracted search query for products: uses_search_operator=false
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation reviews (rti 2)
WARNING:  ParadeDB: Extracted search query for reviews: uses_search_operator=false
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for products - uses_search: false
WARNING:  ParadeDB: Inner predicate for reviews - uses_search: false
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
WARNING:  ParadeDB: Join pathlist callback called - jointype: 0, outer relids: ["reviews"], inner relids: ["products"]
WARNING:  ParadeDB: Checking relation reviews (rti 2) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation reviews
WARNING:  ParadeDB: Checking relation products (rti 1) for BM25 index
WARNING:  ParadeDB: Found BM25 index for relation products
WARNING:  ParadeDB: Join is feasible - would create custom join path here
WARNING:  ParadeDB: Analyzing join search predicates
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation reviews (rti 2)
WARNING:  ParadeDB: Extracted search query for reviews: uses_search_operator=false
WARNING:  ParadeDB: Analyzing 1 base restriction clauses for relation
WARNING:  ParadeDB: Extracting predicates for relation products (rti 1)
WARNING:  ParadeDB: Extracted search query for products: uses_search_operator=false
WARNING:  ParadeDB: Extracted 1 outer predicates, 1 inner predicates, 0 join conditions
WARNING:  ParadeDB: Found search predicates - outer: 1, inner: 1, bilateral: true
WARNING:  ParadeDB: Outer predicate for reviews - uses_search: false
WARNING:  ParadeDB: Inner predicate for products - uses_search: false
WARNING:  ParadeDB: Join path estimates - rows: 1, startup_cost: 100.00, total_cost: 100.01
WARNING:  ParadeDB: Created custom join path, adding to joinrel
    name    | reviewer_name 
------------+---------------
 Laptop Pro | John Doe
 Laptop Pro | Jane Smith
(2 rows)

-- Cleanup
DROP TABLE products CASCADE;
DROP TABLE reviews CASCADE;
RESET paradedb.enable_custom_join; 
