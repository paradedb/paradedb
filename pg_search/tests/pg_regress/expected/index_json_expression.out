\i common/common_setup.sql
CREATE EXTENSION IF NOT EXISTS pg_search;
-- Disable parallel workers to avoid differences in plans
SET max_parallel_workers_per_gather = 0;
SET enable_indexscan to OFF;
SET paradedb.enable_mixed_fast_field_exec = true;
CALL paradedb.create_bm25_test_table(
  schema_name => 'public',
  table_name => 'mock_items'
);
CREATE INDEX search_idx ON mock_items
USING bm25 (id, (metadata->>'color'))
WITH (key_field='id');
EXPLAIN SELECT COUNT(*) FROM mock_items WHERE metadata->>'color' @@@ 'white';
                                                                         QUERY PLAN                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------
 Aggregate  (cost=10.01..10.02 rows=1 width=8)
   ->  Custom Scan (ParadeDB Scan) on mock_items  (cost=10.00..10.01 rows=1 width=0)
         Table: mock_items
         Index: search_idx
         Segment Count: 1
         Exec Method: NormalScanExecState
         Scores: false
         Tantivy Query: {"with_index":{"query":{"parse_with_field":{"field":"_pg_search_1","query_string":"white","lenient":null,"conjunction_mode":null}}}}
(8 rows)

SELECT COUNT(*) FROM mock_items WHERE metadata->>'color' @@@ 'white';
 count 
-------
     3
(1 row)

DROP TABLE mock_items;
