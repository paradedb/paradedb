\i common/common_setup.sql
CREATE EXTENSION IF NOT EXISTS pg_search;
-- Disable parallel workers to avoid differences in plans
SET max_parallel_workers_per_gather = 0;
SET enable_indexscan to OFF;
SET paradedb.enable_mixed_fast_field_exec = true;
DROP TABLE IF EXISTS t;
CREATE TABLE t (id SERIAL PRIMARY KEY, indexed TEXT, nonindexed TEXT);
INSERT INTO t (indexed, nonindexed) VALUES ('hello', 'world');
CREATE INDEX t_idx ON t USING bm25 (id, indexed) WITH (key_field = 'indexed');
SELECT pdb.snippet(indexed) FROM t WHERE indexed @@@ 'hello' AND nonindexed = 'world';
   snippet    
--------------
 <b>hello</b>
(1 row)

SELECT pdb.snippet(nonindexed) FROM t WHERE indexed @@@ 'hello' AND nonindexed = 'world';
ERROR:  cannot generate snippet for field nonindexed because it was not found in the index
DROP TABLE t;
