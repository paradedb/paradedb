\i common/common_setup.sql
CREATE EXTENSION IF NOT EXISTS pg_search;
-- Disable parallel workers to avoid differences in plans
SET max_parallel_workers_per_gather = 0;
SET enable_indexscan to OFF;
SET paradedb.enable_mixed_fast_field_exec = true;
CALL paradedb.create_bm25_test_table(
  schema_name => 'public',
  table_name => 'mock_items'
);
CREATE INDEX search_idx ON mock_items
USING bm25 (id, (metadata::pdb.literal))
WITH (key_field='id');
SELECT pdb.agg('{"terms": {"field": "metadata.color"}}')
FROM mock_items
WHERE id @@@ pdb.all();
                                                                                                                                                                                                                agg                                                                                                                                                                                                                 
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 {"buckets": [{"key": "Brown", "doc_count": 10}, {"key": "Multicolor", "doc_count": 8}, {"key": "Black", "doc_count": 8}, {"key": "Blue", "doc_count": 4}, {"key": "White", "doc_count": 3}, {"key": "Silver", "doc_count": 2}, {"key": "Clear", "doc_count": 1}, {"key": "Green", "doc_count": 1}, {"key": "Red", "doc_count": 1}, {"key": "Yellow", "doc_count": 1}], "sum_other_doc_count": 2, "doc_count_error_upper_bound": 0}
(1 row)

DROP TABLE mock_items;
