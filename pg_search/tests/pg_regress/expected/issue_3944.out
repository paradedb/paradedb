\i common/common_setup.sql
CREATE EXTENSION IF NOT EXISTS pg_search;
-- Disable parallel workers to avoid differences in plans
SET max_parallel_workers_per_gather = 0;
SET enable_indexscan to OFF;
SET paradedb.enable_mixed_fast_field_exec = true;
DROP TABLE IF EXISTS alias_json;
CREATE TABLE alias_json (
    id SERIAL PRIMARY KEY,
    metadata JSONB
);
INSERT INTO alias_json (metadata) VALUES
    ('{"name": "red apple", "tags": ["test", "jsonb"]}'),
    ('{"name": "blueberry", "tags": ["test", "jsonb"]}');
CREATE INDEX alias_idx ON alias_json USING bm25 (id, metadata, (metadata::pdb.simple('alias=metadata_simple'))) WITH (key_field = 'id');
SELECT * FROM paradedb.schema('alias_idx');
      name       | field_type | stored | indexed | fast | fieldnorms | expand_dots |            tokenizer             |  record  | normalizer 
-----------------+------------+--------+---------+------+------------+-------------+----------------------------------+----------+------------
 ctid            | U64        | f      | t       | t    | f          |             |                                  |          | 
 id              | I64        | f      | t       | t    | f          |             |                                  |          | 
 metadata        | JsonObject | f      | t       | f    | f          | t           | unicode_words_removeemojis:false | position | 
 metadata_simple | JsonObject | f      | t       | f    | f          | t           | default                          | position | 
(4 rows)

SELECT * FROM alias_json WHERE id @@@ pdb.parse('metadata_simple.name:red');
 id |                     metadata                     
----+--------------------------------------------------
  1 | {"name": "red apple", "tags": ["test", "jsonb"]}
(1 row)

DROP TABLE alias_json;
