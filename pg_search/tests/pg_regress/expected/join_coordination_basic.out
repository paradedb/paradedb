-- Test JOIN coordination execution method
-- This test validates that the JOIN coordination execution method is selected
-- for multi-table queries with search predicates and LIMIT clauses
-- Create the extension first
CREATE EXTENSION IF NOT EXISTS pg_search;
-- Enable JOIN coordination GUC and verify it works
SET paradedb.enable_join_coordination = true;
-- Create test tables with BM25 indexes
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    title TEXT,
    content TEXT
);
CREATE TABLE files (
    id SERIAL PRIMARY KEY,
    document_id INTEGER REFERENCES documents(id),
    filename TEXT,
    title TEXT
);
CREATE TABLE pages (
    id SERIAL PRIMARY KEY,
    file_id INTEGER REFERENCES files(id),
    page_number INTEGER,
    content TEXT
);
-- Create BM25 indexes
CALL paradedb.create_bm25_test_table(
    table_name => 'documents',
    schema_name => 'public'
);
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: -1
WARNING:    outer_has_search: false
WARNING:    inner_has_search: false
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: -1
WARNING:    outer_has_search: false
WARNING:    inner_has_search: false
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  The table public.documents already exists, skipping.
CALL paradedb.create_bm25_test_table(
    table_name => 'files',
    schema_name => 'public'
);
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: -1
WARNING:    outer_has_search: false
WARNING:    inner_has_search: false
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: -1
WARNING:    outer_has_search: false
WARNING:    inner_has_search: false
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  The table public.files already exists, skipping.
CALL paradedb.create_bm25_test_table(
    table_name => 'pages',
    schema_name => 'public'
);
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: -1
WARNING:    outer_has_search: false
WARNING:    inner_has_search: false
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: -1
WARNING:    outer_has_search: false
WARNING:    inner_has_search: false
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  The table public.pages already exists, skipping.
-- Create the actual BM25 indexes
CREATE INDEX documents_search_idx ON documents USING bm25 (id, title, content) WITH (key_field='id');
CREATE INDEX files_search_idx ON files USING bm25 (id, document_id, filename, title) WITH (key_field='id');
CREATE INDEX pages_search_idx ON pages USING bm25 (id, file_id, page_number, content) WITH (key_field='id');
-- Insert test data
INSERT INTO documents (title, content) VALUES
    ('Document 1', 'This is the first document about technology'),
    ('Document 2', 'This is the second document about science'),
    ('Document 3', 'This is the third document about research');
INSERT INTO files (document_id, filename, title) VALUES
    (1, 'file1.pdf', 'Technology Report'),
    (1, 'file2.pdf', 'Tech Analysis'),
    (2, 'file3.pdf', 'Science Paper'),
    (3, 'file4.pdf', 'Research Notes');
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 1 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 has NO search operators
WARNING:  RTI 1 has BM25 index but NO search predicates
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=false, count=0, beneficial=false ===
WARNING:  Setting multi-table info for RTI 1: multi_table=false, count=0, beneficial=false
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 1 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 has NO search operators
WARNING:  RTI 1 has BM25 index but NO search predicates
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=false, count=0, beneficial=false ===
WARNING:  Setting multi-table info for RTI 1: multi_table=false, count=0, beneficial=false
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 1 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 has NO search operators
WARNING:  RTI 1 has BM25 index but NO search predicates
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=false, count=0, beneficial=false ===
WARNING:  Setting multi-table info for RTI 1: multi_table=false, count=0, beneficial=false
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 1 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 has NO search operators
WARNING:  RTI 1 has BM25 index but NO search predicates
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=false, count=0, beneficial=false ===
WARNING:  Setting multi-table info for RTI 1: multi_table=false, count=0, beneficial=false
INSERT INTO pages (file_id, page_number, content) VALUES
    (1, 1, 'Introduction to technology trends'),
    (1, 2, 'Advanced technology concepts'),
    (2, 1, 'Technology analysis methodology'),
    (3, 1, 'Scientific research methods'),
    (4, 1, 'Research findings and conclusions');
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 1 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 has NO search operators
WARNING:  RTI 1 has BM25 index but NO search predicates
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=false, count=0, beneficial=false ===
WARNING:  Setting multi-table info for RTI 1: multi_table=false, count=0, beneficial=false
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 1 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 has NO search operators
WARNING:  RTI 1 has BM25 index but NO search predicates
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=false, count=0, beneficial=false ===
WARNING:  Setting multi-table info for RTI 1: multi_table=false, count=0, beneficial=false
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 1 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 has NO search operators
WARNING:  RTI 1 has BM25 index but NO search predicates
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=false, count=0, beneficial=false ===
WARNING:  Setting multi-table info for RTI 1: multi_table=false, count=0, beneficial=false
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 1 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 has NO search operators
WARNING:  RTI 1 has BM25 index but NO search predicates
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=false, count=0, beneficial=false ===
WARNING:  Setting multi-table info for RTI 1: multi_table=false, count=0, beneficial=false
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 1 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 has NO search operators
WARNING:  RTI 1 has BM25 index but NO search predicates
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=false, count=0, beneficial=false ===
WARNING:  Setting multi-table info for RTI 1: multi_table=false, count=0, beneficial=false
-- Test 1: Single table query (should NOT use JOIN coordination)
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF)
SELECT d.id, d.title
FROM documents d
WHERE d.content @@@ 'technology'
LIMIT 10;
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 1 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 FOUND search operator in restrict info 0
WARNING:  RTI 1 HAS search predicates! Total count now: 1
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=false, count=1, beneficial=false ===
WARNING:  Setting multi-table info for RTI 1: multi_table=false, count=1, beneficial=false
WARNING:  === CHOOSING EXECUTION METHOD ===
WARNING:    limit: Some(10)
WARNING:    sort_direction: Some(None)
WARNING:    CHOSEN: TopN (limit=10, sort_direction=None)
                                                                         QUERY PLAN                                                                          
-------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit
   ->  Custom Scan (ParadeDB Scan) on documents d
         Table: documents
         Index: documents_search_idx
         Exec Method: TopNScanExecState
         Scores: false
            Top N Limit: 10
         Tantivy Query: {"with_index":{"query":{"parse_with_field":{"field":"content","query_string":"technology","lenient":null,"conjunction_mode":null}}}}
(8 rows)

-- Test 2: Multi-table query with search predicates and LIMIT (should use JOIN coordination)
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF)
SELECT d.id, f.id, p.id
FROM documents d
JOIN files f ON d.id = f.document_id
JOIN pages p ON f.id = p.file_id
WHERE d.content @@@ 'technology' 
  AND f.title @@@ 'report'
  AND p.content @@@ 'introduction'
LIMIT 10;
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 5 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 FOUND search operator in restrict info 0
WARNING:  RTI 1 HAS search predicates! Total count now: 1
WARNING:  Examining RTI 2: rtekind = 0
WARNING:  RTI 2 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 2
WARNING:    RTI 2 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 2 FOUND search operator in restrict info 0
WARNING:  RTI 2 HAS search predicates! Total count now: 2
WARNING:  Examining RTI 3: rtekind = 2
WARNING:  RTI 3 is not a relation, skipping
WARNING:  Examining RTI 4: rtekind = 0
WARNING:  RTI 4 has BM25 index: table_oid=pages, index_oid=pages_search_idx
WARNING:    Checking search predicates for RTI 4
WARNING:    RTI 4 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 4 FOUND search operator in restrict info 0
WARNING:  RTI 4 HAS search predicates! Total count now: 3
WARNING:  Examining RTI 5: rtekind = 2
WARNING:  RTI 5 is not a relation, skipping
WARNING:  Found 3 tables with search predicates - marking as beneficial JOINs
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=true, count=3, beneficial=true ===
WARNING:  Setting multi-table info for RTI 1: multi_table=true, count=3, beneficial=true
WARNING:  === CHOOSING EXECUTION METHOD ===
WARNING:    limit: None
WARNING:    sort_direction: None
WARNING:  === CHECKING JOIN COORDINATION ELIGIBILITY ===
WARNING:    is_multi_table_search: true
WARNING:    multi_table_search_count: 3
WARNING:    has_limit: false
WARNING:    limit_value: None
WARNING:    has_beneficial_joins: true
WARNING:    sort_direction: None
WARNING:    DISABLED: JOIN coordination now handled at JOIN planning level
WARNING:    CHOSEN: FastFieldNumeric
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 2 ===
WARNING:  Range table has 5 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 FOUND search operator in restrict info 0
WARNING:  RTI 1 HAS search predicates! Total count now: 1
WARNING:  Examining RTI 2: rtekind = 0
WARNING:  RTI 2 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 2
WARNING:    RTI 2 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 2 FOUND search operator in restrict info 0
WARNING:  RTI 2 HAS search predicates! Total count now: 2
WARNING:  Examining RTI 3: rtekind = 2
WARNING:  RTI 3 is not a relation, skipping
WARNING:  Examining RTI 4: rtekind = 0
WARNING:  RTI 4 has BM25 index: table_oid=pages, index_oid=pages_search_idx
WARNING:    Checking search predicates for RTI 4
WARNING:    RTI 4 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 4 FOUND search operator in restrict info 0
WARNING:  RTI 4 HAS search predicates! Total count now: 3
WARNING:  Examining RTI 5: rtekind = 2
WARNING:  RTI 5 is not a relation, skipping
WARNING:  Found 3 tables with search predicates - marking as beneficial JOINs
WARNING:  === FINAL RESULT for RTI 2: is_multi_table=true, count=3, beneficial=true ===
WARNING:  Setting multi-table info for RTI 2: multi_table=true, count=3, beneficial=true
WARNING:  === CHOOSING EXECUTION METHOD ===
WARNING:    limit: None
WARNING:    sort_direction: None
WARNING:  === CHECKING JOIN COORDINATION ELIGIBILITY ===
WARNING:    is_multi_table_search: true
WARNING:    multi_table_search_count: 3
WARNING:    has_limit: false
WARNING:    limit_value: None
WARNING:    has_beneficial_joins: true
WARNING:    sort_direction: None
WARNING:    DISABLED: JOIN coordination now handled at JOIN planning level
WARNING:    CHOSEN: FastFieldNumeric
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 4 ===
WARNING:  Range table has 5 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 FOUND search operator in restrict info 0
WARNING:  RTI 1 HAS search predicates! Total count now: 1
WARNING:  Examining RTI 2: rtekind = 0
WARNING:  RTI 2 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 2
WARNING:    RTI 2 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 2 FOUND search operator in restrict info 0
WARNING:  RTI 2 HAS search predicates! Total count now: 2
WARNING:  Examining RTI 3: rtekind = 2
WARNING:  RTI 3 is not a relation, skipping
WARNING:  Examining RTI 4: rtekind = 0
WARNING:  RTI 4 has BM25 index: table_oid=pages, index_oid=pages_search_idx
WARNING:    Checking search predicates for RTI 4
WARNING:    RTI 4 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 4 FOUND search operator in restrict info 0
WARNING:  RTI 4 HAS search predicates! Total count now: 3
WARNING:  Examining RTI 5: rtekind = 2
WARNING:  RTI 5 is not a relation, skipping
WARNING:  Found 3 tables with search predicates - marking as beneficial JOINs
WARNING:  === FINAL RESULT for RTI 4: is_multi_table=true, count=3, beneficial=true ===
WARNING:  Setting multi-table info for RTI 4: multi_table=true, count=3, beneficial=true
WARNING:  === CHOOSING EXECUTION METHOD ===
WARNING:    limit: None
WARNING:    sort_direction: None
WARNING:  === CHECKING JOIN COORDINATION ELIGIBILITY ===
WARNING:    is_multi_table_search: true
WARNING:    multi_table_search_count: 3
WARNING:    has_limit: false
WARNING:    limit_value: None
WARNING:    has_beneficial_joins: true
WARNING:    sort_direction: None
WARNING:    DISABLED: JOIN coordination now handled at JOIN planning level
WARNING:    CHOSEN: FastFieldNumeric
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: true
WARNING:    has_limit: true
WARNING:    CREATING JOIN COORDINATION PATH!
WARNING:      RTI 1 maps to table OID documents
WARNING:      Found table OID documents for RTI 1
WARNING:    Extracted outer table OID: documents (RTI: 1)
WARNING:      RTI 2 maps to table OID files
WARNING:      Found table OID files for RTI 2
WARNING:    Extracted inner table OID: files (RTI: 2)
WARNING:      RTI 1 maps to table OID documents
WARNING:      RTI 2 maps to table OID files
WARNING:    Extracted JOIN condition: documents[1] = files[2]
WARNING:    Extracted 1 JOIN conditions
WARNING:    JOIN private data: 2 tables, limit: Some(10)
WARNING:    Serialized JSON: {"relation_mapping":{"164156":2,"164147":1},"table_oids":[164147,164156],"limit":10,"join_conditions":[{"left":[164147,1],"right":[164156,2],"opno":96}]}
WARNING:    Created persistent string at: 0x7ff6f9817138
WARNING:    Created string node: 0x7ff6f9817248
WARNING:    Added node to list, list length: 1
WARNING:    Creating custom path: startup_cost=20, total_cost=1.6, rows=1
WARNING:    CustomPath created successfully with joinrel.reltarget
WARNING:    SUCCESSFULLY CREATED JOIN COORDINATION PATH!
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: true
WARNING:    has_limit: true
WARNING:    CREATING JOIN COORDINATION PATH!
WARNING:      RTI 2 maps to table OID files
WARNING:      Found table OID files for RTI 2
WARNING:    Extracted outer table OID: files (RTI: 2)
WARNING:      RTI 1 maps to table OID documents
WARNING:      Found table OID documents for RTI 1
WARNING:    Extracted inner table OID: documents (RTI: 1)
WARNING:      RTI 1 maps to table OID documents
WARNING:      RTI 2 maps to table OID files
WARNING:    Extracted JOIN condition: documents[1] = files[2]
WARNING:    Extracted 1 JOIN conditions
WARNING:    JOIN private data: 2 tables, limit: Some(10)
WARNING:    Serialized JSON: {"relation_mapping":{"164156":2,"164147":1},"table_oids":[164156,164147],"limit":10,"join_conditions":[{"left":[164147,1],"right":[164156,2],"opno":96}]}
WARNING:    Created persistent string at: 0x7ff6d9011840
WARNING:    Created string node: 0x7ff6d9011950
WARNING:    Added node to list, list length: 1
WARNING:    Creating custom path: startup_cost=20, total_cost=1.6, rows=1
WARNING:    CustomPath created successfully with joinrel.reltarget
WARNING:    SUCCESSFULLY CREATED JOIN COORDINATION PATH!
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: true
WARNING:    has_limit: true
WARNING:    CREATING JOIN COORDINATION PATH!
WARNING:      RTI 2 maps to table OID files
WARNING:      Found table OID files for RTI 2
WARNING:    Extracted outer table OID: files (RTI: 2)
WARNING:      RTI 4 maps to table OID pages
WARNING:      Found table OID pages for RTI 4
WARNING:    Extracted inner table OID: pages (RTI: 4)
WARNING:      RTI 2 maps to table OID files
WARNING:      RTI 4 maps to table OID pages
WARNING:    Extracted JOIN condition: files[1] = pages[2]
WARNING:    Extracted 1 JOIN conditions
WARNING:    JOIN private data: 2 tables, limit: Some(10)
WARNING:    Serialized JSON: {"relation_mapping":{"164156":2,"164170":4},"table_oids":[164156,164170],"limit":10,"join_conditions":[{"left":[164156,1],"right":[164170,2],"opno":96}]}
WARNING:    Created persistent string at: 0x7ff6d903b208
WARNING:    Created string node: 0x7ff6d903b318
WARNING:    Added node to list, list length: 1
WARNING:    Creating custom path: startup_cost=20, total_cost=1.6, rows=1
WARNING:    CustomPath created successfully with joinrel.reltarget
WARNING:    SUCCESSFULLY CREATED JOIN COORDINATION PATH!
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: true
WARNING:    has_limit: true
WARNING:    CREATING JOIN COORDINATION PATH!
WARNING:      RTI 4 maps to table OID pages
WARNING:      Found table OID pages for RTI 4
WARNING:    Extracted outer table OID: pages (RTI: 4)
WARNING:      RTI 2 maps to table OID files
WARNING:      Found table OID files for RTI 2
WARNING:    Extracted inner table OID: files (RTI: 2)
WARNING:      RTI 2 maps to table OID files
WARNING:      RTI 4 maps to table OID pages
WARNING:    Extracted JOIN condition: files[1] = pages[2]
WARNING:    Extracted 1 JOIN conditions
WARNING:    JOIN private data: 2 tables, limit: Some(10)
WARNING:    Serialized JSON: {"relation_mapping":{"164156":2,"164170":4},"table_oids":[164170,164156],"limit":10,"join_conditions":[{"left":[164156,1],"right":[164170,2],"opno":96}]}
WARNING:    Created persistent string at: 0x7ff6d903d6b8
WARNING:    Created string node: 0x7ff6d903d7c8
WARNING:    Added node to list, list length: 1
WARNING:    Creating custom path: startup_cost=20, total_cost=1.6, rows=1
WARNING:    CustomPath created successfully with joinrel.reltarget
WARNING:    SUCCESSFULLY CREATED JOIN COORDINATION PATH!
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: false
WARNING:    inner_has_search: true
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: false
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: false
WARNING:    inner_has_search: true
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: false
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === PLANNING JOIN COORDINATION CUSTOM PATH ===
WARNING:    rel relids: ["documents", "files"]
WARNING:    tlist length: 2
WARNING:    Private data: 2 tables, limit: Some(10)
WARNING:    Using joinrel target list with 2 expressions
WARNING:    Created CustomScan plan for JOIN coordination
WARNING:    startup_cost: 20, total_cost: 1.6, rows: 1
ERROR:  variable not found in subplan target list
-- Test 3: Multi-table query without LIMIT (should NOT use JOIN coordination)
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF)
SELECT d.id, f.id
FROM documents d
JOIN files f ON d.id = f.document_id
WHERE d.content @@@ 'technology' 
  AND f.title @@@ 'report';
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 3 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 FOUND search operator in restrict info 0
WARNING:  RTI 1 HAS search predicates! Total count now: 1
WARNING:  Examining RTI 2: rtekind = 0
WARNING:  RTI 2 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 2
WARNING:    RTI 2 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 2 FOUND search operator in restrict info 0
WARNING:  RTI 2 HAS search predicates! Total count now: 2
WARNING:  Examining RTI 3: rtekind = 2
WARNING:  RTI 3 is not a relation, skipping
WARNING:  Found 2 tables with search predicates - marking as beneficial JOINs
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=true, count=2, beneficial=true ===
WARNING:  Setting multi-table info for RTI 1: multi_table=true, count=2, beneficial=true
WARNING:  === CHOOSING EXECUTION METHOD ===
WARNING:    limit: None
WARNING:    sort_direction: None
WARNING:  === CHECKING JOIN COORDINATION ELIGIBILITY ===
WARNING:    is_multi_table_search: true
WARNING:    multi_table_search_count: 2
WARNING:    has_limit: false
WARNING:    limit_value: None
WARNING:    has_beneficial_joins: true
WARNING:    sort_direction: None
WARNING:    DISABLED: JOIN coordination now handled at JOIN planning level
WARNING:    CHOSEN: FastFieldNumeric
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 2 ===
WARNING:  Range table has 3 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 FOUND search operator in restrict info 0
WARNING:  RTI 1 HAS search predicates! Total count now: 1
WARNING:  Examining RTI 2: rtekind = 0
WARNING:  RTI 2 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 2
WARNING:    RTI 2 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 2 FOUND search operator in restrict info 0
WARNING:  RTI 2 HAS search predicates! Total count now: 2
WARNING:  Examining RTI 3: rtekind = 2
WARNING:  RTI 3 is not a relation, skipping
WARNING:  Found 2 tables with search predicates - marking as beneficial JOINs
WARNING:  === FINAL RESULT for RTI 2: is_multi_table=true, count=2, beneficial=true ===
WARNING:  Setting multi-table info for RTI 2: multi_table=true, count=2, beneficial=true
WARNING:  === CHOOSING EXECUTION METHOD ===
WARNING:    limit: None
WARNING:    sort_direction: None
WARNING:  === CHECKING JOIN COORDINATION ELIGIBILITY ===
WARNING:    is_multi_table_search: true
WARNING:    multi_table_search_count: 2
WARNING:    has_limit: false
WARNING:    limit_value: None
WARNING:    has_beneficial_joins: true
WARNING:    sort_direction: None
WARNING:    DISABLED: JOIN coordination now handled at JOIN planning level
WARNING:    CHOSEN: FastFieldNumeric
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: -1
WARNING:    outer_has_search: true
WARNING:    inner_has_search: true
WARNING:    has_limit: false
WARNING:    SKIPPING: No LIMIT clause
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: -1
WARNING:    outer_has_search: true
WARNING:    inner_has_search: true
WARNING:    has_limit: false
WARNING:    SKIPPING: No LIMIT clause
                                                                               QUERY PLAN                                                                                
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Gather
   Workers Planned: 1
   ->  Parallel Hash Join
         Hash Cond: (f.document_id = d.id)
         ->  Parallel Custom Scan (ParadeDB Scan) on files f
               Table: files
               Index: files_search_idx
               Exec Method: NumericFastFieldExecState
               Fast Fields: document_id, id
               Scores: false
               Tantivy Query: {"with_index":{"query":{"parse_with_field":{"field":"title","query_string":"report","lenient":null,"conjunction_mode":null}}}}
         ->  Parallel Hash
               ->  Parallel Custom Scan (ParadeDB Scan) on documents d
                     Table: documents
                     Index: documents_search_idx
                     Exec Method: NumericFastFieldExecState
                     Fast Fields: id
                     Scores: false
                     Tantivy Query: {"with_index":{"query":{"parse_with_field":{"field":"content","query_string":"technology","lenient":null,"conjunction_mode":null}}}}
(19 rows)

-- Test 4: Multi-table query with only one search predicate (should NOT use JOIN coordination)
EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF)
SELECT d.id, f.id
FROM documents d
JOIN files f ON d.id = f.document_id
WHERE d.content @@@ 'technology'
LIMIT 10;
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 3 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 FOUND search operator in restrict info 0
WARNING:  RTI 1 HAS search predicates! Total count now: 1
WARNING:  Examining RTI 2: rtekind = 0
WARNING:  RTI 2 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 2
WARNING:    RTI 2 has 0 base restrict info entries
WARNING:    RTI 2 has NO search operators
WARNING:  RTI 2 has BM25 index but NO search predicates
WARNING:  Examining RTI 3: rtekind = 2
WARNING:  RTI 3 is not a relation, skipping
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=false, count=1, beneficial=false ===
WARNING:  Setting multi-table info for RTI 1: multi_table=false, count=1, beneficial=false
WARNING:  === CHOOSING EXECUTION METHOD ===
WARNING:    limit: None
WARNING:    sort_direction: None
WARNING:  === CHECKING JOIN COORDINATION ELIGIBILITY ===
WARNING:    is_multi_table_search: false
WARNING:    multi_table_search_count: 1
WARNING:    has_limit: false
WARNING:    limit_value: None
WARNING:    has_beneficial_joins: false
WARNING:    sort_direction: None
WARNING:    DISABLED: JOIN coordination now handled at JOIN planning level
WARNING:    CHOSEN: FastFieldNumeric
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: false
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: false
WARNING:    inner_has_search: true
WARNING:    SKIPPING: Not both relations have search predicates
                                                                               QUERY PLAN                                                                                
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Limit
   ->  Nested Loop
         Join Filter: (d.id = f.document_id)
         ->  Gather
               Workers Planned: 1
               ->  Parallel Custom Scan (ParadeDB Scan) on documents d
                     Table: documents
                     Index: documents_search_idx
                     Exec Method: NumericFastFieldExecState
                     Fast Fields: id
                     Scores: false
                     Tantivy Query: {"with_index":{"query":{"parse_with_field":{"field":"content","query_string":"technology","lenient":null,"conjunction_mode":null}}}}
         ->  Seq Scan on files f
(13 rows)

-- Test 5: Verify that results are correct
SELECT d.title, f.filename, p.content
FROM documents d
JOIN files f ON d.id = f.document_id
JOIN pages p ON f.id = p.file_id
WHERE d.content @@@ 'technology' 
  AND f.title @@@ 'report'
  AND p.content @@@ 'introduction'
LIMIT 10;
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 1 ===
WARNING:  Range table has 5 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 FOUND search operator in restrict info 0
WARNING:  RTI 1 HAS search predicates! Total count now: 1
WARNING:  Examining RTI 2: rtekind = 0
WARNING:  RTI 2 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 2
WARNING:    RTI 2 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 2 FOUND search operator in restrict info 0
WARNING:  RTI 2 HAS search predicates! Total count now: 2
WARNING:  Examining RTI 3: rtekind = 2
WARNING:  RTI 3 is not a relation, skipping
WARNING:  Examining RTI 4: rtekind = 0
WARNING:  RTI 4 has BM25 index: table_oid=pages, index_oid=pages_search_idx
WARNING:    Checking search predicates for RTI 4
WARNING:    RTI 4 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 4 FOUND search operator in restrict info 0
WARNING:  RTI 4 HAS search predicates! Total count now: 3
WARNING:  Examining RTI 5: rtekind = 2
WARNING:  RTI 5 is not a relation, skipping
WARNING:  Found 3 tables with search predicates - marking as beneficial JOINs
WARNING:  === FINAL RESULT for RTI 1: is_multi_table=true, count=3, beneficial=true ===
WARNING:  Setting multi-table info for RTI 1: multi_table=true, count=3, beneficial=true
WARNING:  === CHOOSING EXECUTION METHOD ===
WARNING:    limit: None
WARNING:    sort_direction: None
WARNING:  === CHECKING JOIN COORDINATION ELIGIBILITY ===
WARNING:    is_multi_table_search: true
WARNING:    multi_table_search_count: 3
WARNING:    has_limit: false
WARNING:    limit_value: None
WARNING:    has_beneficial_joins: true
WARNING:    sort_direction: None
WARNING:    DISABLED: JOIN coordination now handled at JOIN planning level
WARNING:    CHOSEN: FastFieldNumeric
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 2 ===
WARNING:  Range table has 5 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 FOUND search operator in restrict info 0
WARNING:  RTI 1 HAS search predicates! Total count now: 1
WARNING:  Examining RTI 2: rtekind = 0
WARNING:  RTI 2 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 2
WARNING:    RTI 2 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 2 FOUND search operator in restrict info 0
WARNING:  RTI 2 HAS search predicates! Total count now: 2
WARNING:  Examining RTI 3: rtekind = 2
WARNING:  RTI 3 is not a relation, skipping
WARNING:  Examining RTI 4: rtekind = 0
WARNING:  RTI 4 has BM25 index: table_oid=pages, index_oid=pages_search_idx
WARNING:    Checking search predicates for RTI 4
WARNING:    RTI 4 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 4 FOUND search operator in restrict info 0
WARNING:  RTI 4 HAS search predicates! Total count now: 3
WARNING:  Examining RTI 5: rtekind = 2
WARNING:  RTI 5 is not a relation, skipping
WARNING:  Found 3 tables with search predicates - marking as beneficial JOINs
WARNING:  === FINAL RESULT for RTI 2: is_multi_table=true, count=3, beneficial=true ===
WARNING:  Setting multi-table info for RTI 2: multi_table=true, count=3, beneficial=true
WARNING:  === CHOOSING EXECUTION METHOD ===
WARNING:    limit: None
WARNING:    sort_direction: None
WARNING:  === CHECKING JOIN COORDINATION ELIGIBILITY ===
WARNING:    is_multi_table_search: true
WARNING:    multi_table_search_count: 3
WARNING:    has_limit: false
WARNING:    limit_value: None
WARNING:    has_beneficial_joins: true
WARNING:    sort_direction: None
WARNING:    DISABLED: JOIN coordination now handled at JOIN planning level
WARNING:    CHOSEN: FastFieldNumeric
WARNING:  === JOIN COORDINATION DEBUG: analyze_multi_table_search_scenario called for RTI 4 ===
WARNING:  Range table has 5 entries
WARNING:  Examining RTI 1: rtekind = 0
WARNING:  RTI 1 has BM25 index: table_oid=documents, index_oid=documents_search_idx
WARNING:    Checking search predicates for RTI 1
WARNING:    RTI 1 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 1 FOUND search operator in restrict info 0
WARNING:  RTI 1 HAS search predicates! Total count now: 1
WARNING:  Examining RTI 2: rtekind = 0
WARNING:  RTI 2 has BM25 index: table_oid=files, index_oid=files_search_idx
WARNING:    Checking search predicates for RTI 2
WARNING:    RTI 2 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 2 FOUND search operator in restrict info 0
WARNING:  RTI 2 HAS search predicates! Total count now: 2
WARNING:  Examining RTI 3: rtekind = 2
WARNING:  RTI 3 is not a relation, skipping
WARNING:  Examining RTI 4: rtekind = 0
WARNING:  RTI 4 has BM25 index: table_oid=pages, index_oid=pages_search_idx
WARNING:    Checking search predicates for RTI 4
WARNING:    RTI 4 has 1 base restrict info entries
WARNING:      Checking restrict info 0
WARNING:    RTI 4 FOUND search operator in restrict info 0
WARNING:  RTI 4 HAS search predicates! Total count now: 3
WARNING:  Examining RTI 5: rtekind = 2
WARNING:  RTI 5 is not a relation, skipping
WARNING:  Found 3 tables with search predicates - marking as beneficial JOINs
WARNING:  === FINAL RESULT for RTI 4: is_multi_table=true, count=3, beneficial=true ===
WARNING:  Setting multi-table info for RTI 4: multi_table=true, count=3, beneficial=true
WARNING:  === CHOOSING EXECUTION METHOD ===
WARNING:    limit: None
WARNING:    sort_direction: None
WARNING:  === CHECKING JOIN COORDINATION ELIGIBILITY ===
WARNING:    is_multi_table_search: true
WARNING:    multi_table_search_count: 3
WARNING:    has_limit: false
WARNING:    limit_value: None
WARNING:    has_beneficial_joins: true
WARNING:    sort_direction: None
WARNING:    DISABLED: JOIN coordination now handled at JOIN planning level
WARNING:    CHOSEN: FastFieldNumeric
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: true
WARNING:    has_limit: true
WARNING:    CREATING JOIN COORDINATION PATH!
WARNING:      RTI 1 maps to table OID documents
WARNING:      Found table OID documents for RTI 1
WARNING:    Extracted outer table OID: documents (RTI: 1)
WARNING:      RTI 2 maps to table OID files
WARNING:      Found table OID files for RTI 2
WARNING:    Extracted inner table OID: files (RTI: 2)
WARNING:      RTI 1 maps to table OID documents
WARNING:      RTI 2 maps to table OID files
WARNING:    Extracted JOIN condition: documents[1] = files[2]
WARNING:    Extracted 1 JOIN conditions
WARNING:    JOIN private data: 2 tables, limit: Some(10)
WARNING:    Serialized JSON: {"relation_mapping":{"164156":2,"164147":1},"table_oids":[164147,164156],"limit":10,"join_conditions":[{"left":[164147,1],"right":[164156,2],"opno":96}]}
WARNING:    Created persistent string at: 0x7ff698020708
WARNING:    Created string node: 0x7ff698020818
WARNING:    Added node to list, list length: 1
WARNING:    Creating custom path: startup_cost=20, total_cost=1.6, rows=1
WARNING:    CustomPath created successfully with joinrel.reltarget
WARNING:    SUCCESSFULLY CREATED JOIN COORDINATION PATH!
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: true
WARNING:    has_limit: true
WARNING:    CREATING JOIN COORDINATION PATH!
WARNING:      RTI 2 maps to table OID files
WARNING:      Found table OID files for RTI 2
WARNING:    Extracted outer table OID: files (RTI: 2)
WARNING:      RTI 1 maps to table OID documents
WARNING:      Found table OID documents for RTI 1
WARNING:    Extracted inner table OID: documents (RTI: 1)
WARNING:      RTI 1 maps to table OID documents
WARNING:      RTI 2 maps to table OID files
WARNING:    Extracted JOIN condition: documents[1] = files[2]
WARNING:    Extracted 1 JOIN conditions
WARNING:    JOIN private data: 2 tables, limit: Some(10)
WARNING:    Serialized JSON: {"relation_mapping":{"164156":2,"164147":1},"table_oids":[164156,164147],"limit":10,"join_conditions":[{"left":[164147,1],"right":[164156,2],"opno":96}]}
WARNING:    Created persistent string at: 0x7ff698022bb8
WARNING:    Created string node: 0x7ff698022cc8
WARNING:    Added node to list, list length: 1
WARNING:    Creating custom path: startup_cost=20, total_cost=1.6, rows=1
WARNING:    CustomPath created successfully with joinrel.reltarget
WARNING:    SUCCESSFULLY CREATED JOIN COORDINATION PATH!
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: true
WARNING:    has_limit: true
WARNING:    CREATING JOIN COORDINATION PATH!
WARNING:      RTI 2 maps to table OID files
WARNING:      Found table OID files for RTI 2
WARNING:    Extracted outer table OID: files (RTI: 2)
WARNING:      RTI 4 maps to table OID pages
WARNING:      Found table OID pages for RTI 4
WARNING:    Extracted inner table OID: pages (RTI: 4)
WARNING:      RTI 2 maps to table OID files
WARNING:      RTI 4 maps to table OID pages
WARNING:    Extracted JOIN condition: files[1] = pages[2]
WARNING:    Extracted 1 JOIN conditions
WARNING:    JOIN private data: 2 tables, limit: Some(10)
WARNING:    Serialized JSON: {"relation_mapping":{"164156":2,"164170":4},"table_oids":[164156,164170],"limit":10,"join_conditions":[{"left":[164156,1],"right":[164170,2],"opno":96}]}
WARNING:    Created persistent string at: 0x7ff698025760
WARNING:    Created string node: 0x7ff698025870
WARNING:    Added node to list, list length: 1
WARNING:    Creating custom path: startup_cost=20, total_cost=1.6, rows=1
WARNING:    CustomPath created successfully with joinrel.reltarget
WARNING:    SUCCESSFULLY CREATED JOIN COORDINATION PATH!
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: true
WARNING:    has_limit: true
WARNING:    CREATING JOIN COORDINATION PATH!
WARNING:      RTI 4 maps to table OID pages
WARNING:      Found table OID pages for RTI 4
WARNING:    Extracted outer table OID: pages (RTI: 4)
WARNING:      RTI 2 maps to table OID files
WARNING:      Found table OID files for RTI 2
WARNING:    Extracted inner table OID: files (RTI: 2)
WARNING:      RTI 2 maps to table OID files
WARNING:      RTI 4 maps to table OID pages
WARNING:    Extracted JOIN condition: files[1] = pages[2]
WARNING:    Extracted 1 JOIN conditions
WARNING:    JOIN private data: 2 tables, limit: Some(10)
WARNING:    Serialized JSON: {"relation_mapping":{"164156":2,"164170":4},"table_oids":[164170,164156],"limit":10,"join_conditions":[{"left":[164156,1],"right":[164170,2],"opno":96}]}
WARNING:    Created persistent string at: 0x7ff698027be8
WARNING:    Created string node: 0x7ff698027cf8
WARNING:    Added node to list, list length: 1
WARNING:    Creating custom path: startup_cost=20, total_cost=1.6, rows=1
WARNING:    CustomPath created successfully with joinrel.reltarget
WARNING:    SUCCESSFULLY CREATED JOIN COORDINATION PATH!
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: false
WARNING:    inner_has_search: true
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: false
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: false
WARNING:    inner_has_search: true
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === JOIN PATHLIST CALLBACK ===
WARNING:    jointype: 0
WARNING:    limit_tuples: 10
WARNING:    outer_has_search: true
WARNING:    inner_has_search: false
WARNING:    SKIPPING: Not both relations have search predicates
WARNING:  === PLANNING JOIN COORDINATION CUSTOM PATH ===
WARNING:    rel relids: ["documents", "files"]
WARNING:    tlist length: 3
WARNING:    Private data: 2 tables, limit: Some(10)
WARNING:    Using joinrel target list with 3 expressions
WARNING:    Created CustomScan plan for JOIN coordination
WARNING:    startup_cost: 20, total_cost: 1.6, rows: 1
ERROR:  variable not found in subplan target list
-- Cleanup
DROP TABLE pages;
DROP TABLE files;
DROP TABLE documents; 
RESET paradedb.enable_join_coordination;
