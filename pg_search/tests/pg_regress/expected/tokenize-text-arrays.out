\i common/common_setup.sql
CREATE EXTENSION IF NOT EXISTS pg_search;
-- Disable parallel workers to avoid differences in plans
SET max_parallel_workers_per_gather = 0;
SET enable_indexscan to OFF;
SET paradedb.enable_mixed_fast_field_exec = true;
DROP TABLE IF EXISTS index_text_array;
CREATE TABLE index_text_array(
    id serial8 not null primary key,
    arr text[]
);
INSERT INTO index_text_array (arr) VALUES (ARRAY['red', 'blue', 'blue green']), (ARRAY['blue green']);
CREATE INDEX idxindex_text_array ON index_text_array USING bm25 (id, arr) WITH (key_field = 'id');
SELECT * FROM paradedb.schema('idxindex_text_array') ORDER BY name;
 name | field_type | stored | indexed | fast | fieldnorms | expand_dots |      tokenizer      |  record  | normalizer 
------+------------+--------+---------+------+------------+-------------+---------------------+----------+------------
 arr  | Str        | f      | t       | f    | t          |             | remove_emojis:false | position | 
 ctid | U64        | f      | t       | t    | f          |             |                     |          | 
 id   | I64        | f      | t       | t    | f          |             |                     |          | 
(3 rows)

SELECT * FROM index_text_array WHERE arr === 'red';
 id |           arr           
----+-------------------------
  1 | {red,blue,"blue green"}
(1 row)

SELECT * FROM index_text_array WHERE arr === 'blue';
 id |           arr           
----+-------------------------
  1 | {red,blue,"blue green"}
  2 | {"blue green"}
(2 rows)

SELECT * FROM index_text_array WHERE arr === 'blue green';
 id | arr 
----+-----
(0 rows)

DROP INDEX idxindex_text_array;
CREATE INDEX idxindex_text_array ON index_text_array USING bm25 (id, (arr::pdb.literal)) WITH (key_field = 'id');
SELECT * FROM paradedb.schema('idxindex_text_array') ORDER BY name;
 name | field_type | stored | indexed | fast | fieldnorms | expand_dots |        tokenizer         | record | normalizer 
------+------------+--------+---------+------+------------+-------------+--------------------------+--------+------------
 arr  | Str        | f      | t       | t    | f          |             | keyword[lowercase=false] | basic  | raw
 ctid | U64        | f      | t       | t    | f          |             |                          |        | 
 id   | I64        | f      | t       | t    | f          |             |                          |        | 
(3 rows)

SELECT * FROM index_text_array WHERE arr === 'red';
 id |           arr           
----+-------------------------
  1 | {red,blue,"blue green"}
(1 row)

SELECT * FROM index_text_array WHERE arr === 'blue';
 id |           arr           
----+-------------------------
  1 | {red,blue,"blue green"}
(1 row)

SELECT * FROM index_text_array WHERE arr === 'blue green';
 id |           arr           
----+-------------------------
  1 | {red,blue,"blue green"}
  2 | {"blue green"}
(2 rows)

DROP TABLE index_text_array;
