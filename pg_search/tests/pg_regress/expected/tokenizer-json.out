DROP TABLE IF EXISTS index_json;
CREATE TABLE index_json(
    id serial8 not null primary key,
    j json,
    jb jsonb
);
INSERT INTO index_json (j, jb) VALUES ('{"key1": "value1"}', '{"key2": "value2"}');
CREATE INDEX idxindex_json ON index_json USING bm25 (id, j, jb) WITH (key_field = 'id');
SELECT * FROM paradedb.schema('idxindex_json') ORDER BY name;
 name | field_type | stored | indexed | fast | fieldnorms | expand_dots |            tokenizer             |  record  | normalizer 
------+------------+--------+---------+------+------------+-------------+----------------------------------+----------+------------
 ctid | U64        | f      | t       | t    | f          |             |                                  |          | 
 id   | I64        | f      | t       | t    | f          |             |                                  |          | 
 j    | JsonObject | f      | t       | f    | f          | t           | unicode_words_removeemojis:false | position | 
 jb   | JsonObject | f      | t       | f    | f          | t           | unicode_words_removeemojis:false | position | 
(4 rows)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE j->'key1' @@@ 'value1';
                                                                    QUERY PLAN                                                                    
--------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"parse_with_field":{"field":"j.key1","query_string":"value1","lenient":null,"conjunction_mode":null}}}}
(6 rows)

SELECT * FROM index_json WHERE j->'key1' @@@ 'value1';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE j->'key1' &&& 'value1';
                                                                                          QUERY PLAN                                                                                          
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"match":{"field":"j.key1","value":"value1","tokenizer":null,"distance":null,"transposition_cost_one":null,"prefix":null,"conjunction_mode":true}}}}
(6 rows)

SELECT * FROM index_json WHERE j->'key1' &&& 'value1';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE j->'key1' ||| 'value1';
                                                                                          QUERY PLAN                                                                                           
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"match":{"field":"j.key1","value":"value1","tokenizer":null,"distance":null,"transposition_cost_one":null,"prefix":null,"conjunction_mode":false}}}}
(6 rows)

SELECT * FROM index_json WHERE j->'key1' ||| 'value1';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE j->'key1' ### 'value1';
                                                   QUERY PLAN                                                    
-----------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"tokenized_phrase":{"field":"j.key1","phrase":"value1","slop":null}}}}
(6 rows)

SELECT * FROM index_json WHERE j->'key1' ### 'value1';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE j->'key1' === 'value1';
                                                 QUERY PLAN                                                 
------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"term":{"field":"j.key1","value":"value1","is_datetime":false}}}}
(6 rows)

SELECT * FROM index_json WHERE j->'key1' === 'value1';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE jb->'key2' @@@ 'value2';
                                                                    QUERY PLAN                                                                     
---------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"parse_with_field":{"field":"jb.key2","query_string":"value2","lenient":null,"conjunction_mode":null}}}}
(6 rows)

SELECT * FROM index_json WHERE jb->'key2' @@@ 'value2';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE jb->'key2' &&& 'value2';
                                                                                          QUERY PLAN                                                                                           
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"match":{"field":"jb.key2","value":"value2","tokenizer":null,"distance":null,"transposition_cost_one":null,"prefix":null,"conjunction_mode":true}}}}
(6 rows)

SELECT * FROM index_json WHERE jb->'key2' &&& 'value2';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE jb->'key2' ||| 'value2';
                                                                                           QUERY PLAN                                                                                           
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"match":{"field":"jb.key2","value":"value2","tokenizer":null,"distance":null,"transposition_cost_one":null,"prefix":null,"conjunction_mode":false}}}}
(6 rows)

SELECT * FROM index_json WHERE jb->'key2' ||| 'value2';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE jb->'key2' ### 'value2';
                                                    QUERY PLAN                                                    
------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"tokenized_phrase":{"field":"jb.key2","phrase":"value2","slop":null}}}}
(6 rows)

SELECT * FROM index_json WHERE jb->'key2' ### 'value2';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE jb->'key2' === 'value2';
                                                 QUERY PLAN                                                  
-------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"term":{"field":"jb.key2","value":"value2","is_datetime":false}}}}
(6 rows)

SELECT * FROM index_json WHERE jb->'key2' === 'value2';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

DROP INDEX idxindex_json;
CREATE INDEX idxindex_json ON index_json USING bm25 (id, (j::pdb.ngram(2, 3)), (jb::pdb.whitespace)) WITH (key_field = 'id');
SELECT * FROM paradedb.schema('idxindex_json') ORDER BY name;
 name | field_type | stored | indexed | fast | fieldnorms | expand_dots |                 tokenizer                  |  record  | normalizer 
------+------------+--------+---------+------+------------+-------------+--------------------------------------------+----------+------------
 ctid | U64        | f      | t       | t    | f          |             |                                            |          | 
 id   | I64        | f      | t       | t    | f          |             |                                            |          | 
 j    | JsonObject | f      | t       | f    | f          | t           | ngram_mingram:2_maxgram:3_prefixonly:false | position | 
 jb   | JsonObject | f      | t       | f    | f          | t           | whitespace                                 | position | 
(4 rows)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE j->'key1' @@@ 'value1';
                                                                    QUERY PLAN                                                                    
--------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"parse_with_field":{"field":"j.key1","query_string":"value1","lenient":null,"conjunction_mode":null}}}}
(6 rows)

SELECT * FROM index_json WHERE j->'key1' @@@ 'value1';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE j->'key1' &&& 'value1';
                                                                                          QUERY PLAN                                                                                          
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"match":{"field":"j.key1","value":"value1","tokenizer":null,"distance":null,"transposition_cost_one":null,"prefix":null,"conjunction_mode":true}}}}
(6 rows)

SELECT * FROM index_json WHERE j->'key1' &&& 'value1';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE j->'key1' ||| 'value1';
                                                                                          QUERY PLAN                                                                                           
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"match":{"field":"j.key1","value":"value1","tokenizer":null,"distance":null,"transposition_cost_one":null,"prefix":null,"conjunction_mode":false}}}}
(6 rows)

SELECT * FROM index_json WHERE j->'key1' ||| 'value1';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE j->'key1' ### 'value1';
                                                   QUERY PLAN                                                    
-----------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"tokenized_phrase":{"field":"j.key1","phrase":"value1","slop":null}}}}
(6 rows)

SELECT * FROM index_json WHERE j->'key1' ### 'value1';
 id | j | jb 
----+---+----
(0 rows)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE j->'key1' === 'value1';
                                                 QUERY PLAN                                                 
------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"term":{"field":"j.key1","value":"value1","is_datetime":false}}}}
(6 rows)

SELECT * FROM index_json WHERE j->'key1' === 'value1';
 id | j | jb 
----+---+----
(0 rows)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE jb->'key2' @@@ 'value2';
                                                                    QUERY PLAN                                                                     
---------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"parse_with_field":{"field":"jb.key2","query_string":"value2","lenient":null,"conjunction_mode":null}}}}
(6 rows)

SELECT * FROM index_json WHERE jb->'key2' @@@ 'value2';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE jb->'key2' &&& 'value2';
                                                                                          QUERY PLAN                                                                                           
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"match":{"field":"jb.key2","value":"value2","tokenizer":null,"distance":null,"transposition_cost_one":null,"prefix":null,"conjunction_mode":true}}}}
(6 rows)

SELECT * FROM index_json WHERE jb->'key2' &&& 'value2';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE jb->'key2' ||| 'value2';
                                                                                           QUERY PLAN                                                                                           
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"match":{"field":"jb.key2","value":"value2","tokenizer":null,"distance":null,"transposition_cost_one":null,"prefix":null,"conjunction_mode":false}}}}
(6 rows)

SELECT * FROM index_json WHERE jb->'key2' ||| 'value2';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE jb->'key2' ### 'value2';
                                                    QUERY PLAN                                                    
------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"tokenized_phrase":{"field":"jb.key2","phrase":"value2","slop":null}}}}
(6 rows)

SELECT * FROM index_json WHERE jb->'key2' ### 'value2';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

EXPLAIN (FORMAT TEXT, COSTS OFF, TIMING OFF) SELECT * FROM index_json WHERE jb->'key2' === 'value2';
                                                 QUERY PLAN                                                  
-------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on index_json
   Table: index_json
   Index: idxindex_json
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"with_index":{"query":{"term":{"field":"jb.key2","value":"value2","is_datetime":false}}}}
(6 rows)

SELECT * FROM index_json WHERE jb->'key2' === 'value2';
 id |         j          |         jb         
----+--------------------+--------------------
  1 | {"key1": "value1"} | {"key2": "value2"}
(1 row)

