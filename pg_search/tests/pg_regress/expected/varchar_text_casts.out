\i common/common_setup.sql
CREATE EXTENSION IF NOT EXISTS pg_search;
-- Disable parallel workers to avoid differences in plans
SET max_parallel_workers_per_gather = 0;
SET enable_indexscan to OFF;
SET paradedb.enable_mixed_fast_field_exec = true;
-- Test text/varchar casts for tokenizer types and fieldname
SELECT pdb.tokenize_unicode_words('good job'::varchar);
 tokenize_unicode_words 
------------------------
 {good,job}
(1 row)

SELECT pdb.tokenize_unicode_words('good job'::text);
 tokenize_unicode_words 
------------------------
 {good,job}
(1 row)

DROP TABLE IF EXISTS varchar_text_casts;
CREATE TABLE varchar_text_casts(id int, content text);
INSERT INTO varchar_text_casts VALUES (1, 'a b'), (2, 'a c');
CREATE INDEX varchar_text_casts_idx ON varchar_text_casts
USING bm25 (id, (content::pdb.unicode_words))
WITH (key_field = id);
SELECT id FROM varchar_text_casts
WHERE id @@@ paradedb.phrase('content'::varchar, ARRAY['a', 'b'])
ORDER BY id;
 id 
----
  1
(1 row)

SELECT id FROM varchar_text_casts
WHERE id @@@ paradedb.phrase('content'::text, ARRAY['a', 'b'])
ORDER BY id;
 id 
----
  1
(1 row)

DROP TABLE varchar_text_casts CASCADE;
