\i common/common_setup.sql
CREATE EXTENSION IF NOT EXISTS pg_search;
-- Disable parallel workers to avoid differences in plans
SET max_parallel_workers_per_gather = 0;
SET enable_indexscan to OFF;
SET paradedb.enable_mixed_fast_field_exec = true;
-- Ensure clean state
DROP TABLE IF EXISTS booltest_simple;
-- Create table
CREATE TABLE booltest_simple (
                                 id SERIAL PRIMARY KEY,
                                 description TEXT,
                                 flag BOOLEAN
);
-- Insert data
INSERT INTO booltest_simple (description, flag)
VALUES
    ('hello world', true),
    ('hello parade', false),
    ('other text', true);
-- Create ParadeDB index
CREATE INDEX booltest_simple_idx
    ON booltest_simple
    USING bm25 (id, description)
    WITH (key_field = 'id');
-- Force ParadeDB planner path
SET enable_seqscan = off;
SET enable_indexscan = off;
SET enable_bitmapscan = off;
SET paradedb.enable_filter_pushdown = on;
-- Verify BoolTest fallback stays inside Custom Scan
EXPLAIN (COSTS OFF)
SELECT *
FROM booltest_simple
WHERE description @@@ 'hello'
  AND flag IS TRUE;
                                                                                                                                       QUERY PLAN                                                                                                                                        
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Custom Scan (ParadeDB Scan) on booltest_simple
   Table: booltest_simple
   Index: booltest_simple_idx
   Exec Method: NormalScanExecState
   Scores: false
   Tantivy Query: {"boolean":{"must":[{"heap_filter":{"indexed_query":{"boolean":{"must":[{"with_index":{"query":{"parse_with_field":{"field":"description","query_string":"hello","lenient":null,"conjunction_mode":null}}}}]}},"field_filters":[{"heap_filter":"(flag IS TRUE)"}]}}]}}
(6 rows)

SELECT *
FROM booltest_simple
WHERE description @@@ 'hello'
  AND flag IS TRUE
ORDER BY id;
 id | description | flag 
----+-------------+------
  1 | hello world | t
(1 row)

-- Cleanup
DROP INDEX IF EXISTS booltest_simple_idx;
DROP TABLE booltest_simple;
\i common/common_cleanup.sql
-- Reset parallel workers setting to default
RESET max_parallel_workers_per_gather;
RESET enable_indexscan;
RESET paradedb.enable_mixed_fast_field_exec;
SELECT 'Common tests cleanup complete' AS status; 
            status             
-------------------------------
 Common tests cleanup complete
(1 row)

